<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Calibration – Starsim</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../user_guide/workflows_deploy.html" rel="next">
<link href="../user_guide/workflows_sir_calibration.html" rel="prev">
<link href="..//assets/favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-065a5179aebd64318d7ea99d77b64a9e.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-969ddfa49e00a70eb3423444dbc81f6c.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-065a5179aebd64318d7ea99d77b64a9e.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-93366e8fb675778b1d1303b86401c41b.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-8057c89b6b57390836df940bcc67f706.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../site_libs/bootstrap/bootstrap-93366e8fb675778b1d1303b86401c41b.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-SVDSQH04EM"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-SVDSQH04EM', { 'anonymize_ip': true});
</script>


<link rel="stylesheet" href="../assets/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../assets/starsim-logo.png" alt="" class="navbar-logo light-content">
    <img src="../assets/starsim-logo.png" alt="" class="navbar-logo dark-content">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../whatsnew.html"> 
<span class="menu-text">What’s new</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../tutorials.html"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../user_guide.html"> 
<span class="menu-text">User guide</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../conduct.html"> 
<span class="menu-text">Code of conduct</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../contributing.html"> 
<span class="menu-text">Contributing</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../api/index.html"> 
<span class="menu-text">API reference</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://github.com/starsimhub/starsim" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
    <a href="mailto:info@starsim.org" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-envelope-at-fill"></i></a>
    <a href="https://starsim-idm.slack.com" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-slack"></i></a>
    <a href="https://starsim.org" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-globe"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><strong>User guide</strong></li><li class="breadcrumb-item"><a href="../user_guide/workflows_run.html">Workflows</a></li><li class="breadcrumb-item"><a href="../user_guide/workflows_calibration.html">Calibration</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="../index.html" class="sidebar-logo-link">
      </a>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Home</strong></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../whatsnew.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>What’s new</strong></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../api/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>API reference</strong></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>Tutorials</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/t1_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">T1 - Getting started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/t2_model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">T2 - Building your model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/t3_demographics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">T3 - Demographics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/t4_diseases.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">T4 - Diseases</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/t5_networks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">T5 - Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/t6_interventions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">T6 - Interventions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/solutions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Solutions</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>User guide</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Introduction</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../user_guide/intro_starsim.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">What is Starsim?</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../user_guide/intro_models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Starsim models</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Basic concepts</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../user_guide/basics_model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Model structure</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../user_guide/basics_sim.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The Sim object</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../user_guide/basics_people.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">People, States, and Arrays</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../user_guide/basics_parameters.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Parameters</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Modules</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../user_guide/modules_diseases.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Diseases</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../user_guide/modules_networks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../user_guide/modules_demographics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Demographics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../user_guide/modules_interventions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interventions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../user_guide/modules_analyzers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Analyzers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../user_guide/modules_connectors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Connectors</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Workflows</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../user_guide/workflows_run.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multiple runs</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../user_guide/workflows_sir_calibration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Fit stochastic SIR models to synthetic data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../user_guide/workflows_calibration.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Calibration</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../user_guide/workflows_deploy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Deployment</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../user_guide/workflows_samples.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Samples</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Advanced topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../user_guide/advanced_time.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Time</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../user_guide/advanced_indexing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Array indexing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../user_guide/advanced_distributions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../user_guide/advanced_random.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Random numbers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../user_guide/advanced_profiling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Profiling and debugging</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../user_guide/advanced_nonstandard.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Nonstandard usage</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../conduct.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Code of conduct</strong></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contributing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Contributing</strong></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
        
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><strong>User guide</strong></li><li class="breadcrumb-item"><a href="../user_guide/workflows_run.html">Workflows</a></li><li class="breadcrumb-item"><a href="../user_guide/workflows_calibration.html">Calibration</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Calibration</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Disease models typically require contextualization to a relevant setting of interest prior to addressing “what-if” scenario questions. The process of tuning model input parameters so that model outputs match observed data is known as calibration. There are many approaches to model calibration, ranging from manual tuning to fully Bayesian methods.</p>
<p>For many applications, we have found that an optimization-based approach is sufficient. Such methods avoid the tedious process of manual tuning and are less computationally expensive than fully Bayesian methods. One such optimization-based approach is the <a href="https://optuna.org">Optuna</a> library, which is a Bayesian hyperparameter optimization framework. Optuna is designed for tuning hyperparameters of machine learning models, but it can also be used to calibrate disease models.</p>
<p>Calibration libraries often treat the disease model as a black box, where the input parameters are the “hyperparameters” to be tuned. The calibration process is often iterative and requires a combination of expert knowledge and computational tools. The optimization algorithm iteratively chooses new parameter values to evaluate, and the model is run with these values to generate outputs. The outputs are compared to observed data, and a loss function is calculated to quantify the difference between the model outputs and the observed data. The optimization algorithm then uses this loss function to update its search strategy and choose new parameter values to evaluate. This process continues until the algorithm converges to a set of parameter values that minimize the loss function.</p>
<p>While many optimization algorithms are available, Starsim has a built-in interface to the Optuna library, which we will demonstrate in this guide. We will use a simple Susceptible-Infected-Recovered (SIR) model as an example. We will tune three input parameters, the infectivity parameter, <code>beta</code>, the initial prevalence parameter, <code>init_prev</code>, and the Poisson-distributed degree distribution parameter, <code>n_contacts</code>. We will calibrate the model using a beta-binomial likelihood function so as to match prevalence at three distinct time points.</p>
<p>We begin with a few imports and default settings:</p>
<div id="cell-4" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">##%% Imports and settings</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sciris <span class="im">as</span> sc</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> starsim <span class="im">as</span> ss</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.dates <span class="im">as</span> mdates</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>n_agents <span class="op">=</span> <span class="fl">2e3</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>debug <span class="op">=</span> <span class="va">False</span> <span class="co"># If true, will run in serial</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The calibration class will require a base <a href="../api/sim.html#starsim.sim.Sim" title="0"><code>Sim</code></a> object. This <a href="../api/sim.html#starsim.sim" title="0"><code>sim</code></a> will later be modified according to parameters selected by the optimization engine. The following function creates the base <a href="../api/sim.html#starsim.sim.Sim" title="0"><code>Sim</code></a> object.</p>
<div id="cell-6" class="cell" data-execution_count="2">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_sim():</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    sir <span class="op">=</span> ss.SIR(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>        beta <span class="op">=</span> ss.peryear(<span class="fl">0.075</span>),</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>        init_prev <span class="op">=</span> ss.bernoulli(<span class="fl">0.02</span>),</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    random <span class="op">=</span> ss.RandomNet(n_contacts<span class="op">=</span>ss.poisson(<span class="dv">4</span>))</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    sim <span class="op">=</span> ss.Sim(</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>        n_agents <span class="op">=</span> n_agents,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>        start <span class="op">=</span> ss.date(<span class="st">'2020-01-01'</span>),</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>        stop <span class="op">=</span> ss.date(<span class="st">'2020-02-12'</span>),</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>        dt <span class="op">=</span> ss.days(<span class="dv">1</span>),</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>        diseases <span class="op">=</span> sir,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>        networks <span class="op">=</span> random,</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>        verbose <span class="op">=</span> <span class="dv">0</span>,</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sim</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Now let’s define the calibration parameters. These are the inputs that Optuna will be able to modify. Here, we define three such parameters, <code>beta</code>, <code>init_prev</code>, and <code>n_contacts</code>.</p>
<p>Each parameter entry should have range defined by <code>low</code> and <code>high</code> as well as a <code>guess</code> values. The <code>guess</code> value is not used by Optuna, rather only for a check after calibration completes to see if the new parameters are better than the <code>guess</code> values.</p>
<p>You’ll notice there are a few other parameters that can be specified. For example, the data type of the parameter appears in <code>suggest_type</code>. Possible values are listed in the Optuna documentation, and include <a href="https://optuna.readthedocs.io/en/stable/reference/generated/optuna.trial.Trial.html#optuna.trial.Trial.suggest_float">suggest_float</a> for float values and <a href="https://optuna.readthedocs.io/en/stable/reference/generated/optuna.trial.Trial.html#optuna.trial.Trial.suggest_int">suggest_int</a> for integer types.</p>
<p>To make things easier for the search algorithm, it’s helpful to indicate how outputs are expected to change with inputs. For example, increasing <code>beta</code> from 0.01 to 0.02 should double disease transmission, but increasing from 0.11 to 0.12 will have a small effect. Thus, we indicate that this parameter should be calibrated with <code>log=True</code>.</p>
<div id="cell-8" class="cell" data-execution_count="3">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the calibration parameters</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>calib_pars <span class="op">=</span> <span class="bu">dict</span>(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    beta <span class="op">=</span> <span class="bu">dict</span>(low<span class="op">=</span><span class="fl">0.01</span>, high<span class="op">=</span><span class="fl">0.30</span>, guess<span class="op">=</span><span class="fl">0.15</span>, suggest_type<span class="op">=</span><span class="st">'suggest_float'</span>, log<span class="op">=</span><span class="va">True</span>), <span class="co"># Note the log scale</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    init_prev <span class="op">=</span> <span class="bu">dict</span>(low<span class="op">=</span><span class="fl">0.01</span>, high<span class="op">=</span><span class="fl">0.05</span>, guess<span class="op">=</span><span class="fl">0.15</span>), <span class="co"># Default type is suggest_float, no need to re-specify</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    n_contacts <span class="op">=</span> <span class="bu">dict</span>(low<span class="op">=</span><span class="dv">2</span>, high<span class="op">=</span><span class="dv">10</span>, guess<span class="op">=</span><span class="dv">3</span>, suggest_type<span class="op">=</span><span class="st">'suggest_int'</span>), <span class="co"># Suggest int just for this demo</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The optimization engine iteratively chooses input parameters to simulate. Those parameters are passed into the following <code>build_sim</code> function as a dictionary of <code>calib_pars</code> along with the base <a href="../api/sim.html#starsim.sim" title="0"><code>sim</code></a> and any other key word arguments. The <code>calib_pars</code> will be as above, but importantly will have an additional key named <code>value</code> containing the value selected by Optuna.</p>
<p>When modifying a <a href="../api/sim.html#starsim.sim" title="0"><code>sim</code></a>, it is important to realize that the simulation has not been initialized yet. Nonetheless, the configuration is available for modification at <code>sim.pars</code>, as demonstrated in the function below for the SIR example.</p>
<div id="cell-10" class="cell" data-execution_count="4">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_sim(sim, calib_pars, n_reps<span class="op">=</span><span class="dv">1</span>, <span class="op">**</span>kwargs):</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Modify the base simulation by applying calib_pars. The result can be a</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">    single simulation or multiple simulations if n_reps&gt;1. Note that here we are</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">    simply building the simulation by modifying the base sim. Running the sims</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">    and extracting results will be done by the calibration function.</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    sir <span class="op">=</span> sim.pars.diseases <span class="co"># There is only one disease in this simulation and it is a SIR</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    net <span class="op">=</span> sim.pars.networks <span class="co"># There is only one network in this simulation and it is a RandomNet</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> k, pars <span class="kw">in</span> calib_pars.items(): <span class="co"># Loop over the calibration parameters</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> k <span class="op">==</span> <span class="st">'rand_seed'</span>:</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>            sim.pars.rand_seed <span class="op">=</span> v</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Each item in calib_pars is a dictionary with keys like 'low', 'high',</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'guess', 'suggest_type', and importantly 'value'. The 'value' key is</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># the one we want to use as that's the one selected by the algorithm</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>        v <span class="op">=</span> pars[<span class="st">'value'</span>]</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> k <span class="op">==</span> <span class="st">'beta'</span>:</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>            sir.pars.beta <span class="op">=</span> ss.peryear(v)</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> k <span class="op">==</span> <span class="st">'init_prev'</span>:</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>            sir.pars.init_prev <span class="op">=</span> ss.bernoulli(v)</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> k <span class="op">==</span> <span class="st">'n_contacts'</span>:</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>            net.pars.n_contacts <span class="op">=</span> ss.poisson(v)</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">NotImplementedError</span>(<span class="ss">f'Parameter </span><span class="sc">{</span>k<span class="sc">}</span><span class="ss"> not recognized'</span>)</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If just one simulation per parameter set, return the single simulation</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> n_reps <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> sim</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># But if you'd like to run multiple simulations with the same parameters, we return a MultiSim instead</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note that each simulation will have a different random seed, you can set specific seeds if you like</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Also note that parallel=False and debug=True are important to avoid issues with parallelism in the calibration</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Advanced: If running multiple reps, you can choose if/how they are combined using the "combine_reps" argument to each CalibComponent, introduced below.</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>    ms <span class="op">=</span> ss.MultiSim(sim, iterpars<span class="op">=</span><span class="bu">dict</span>(rand_seed<span class="op">=</span>np.random.randint(<span class="dv">0</span>, <span class="fl">1e6</span>, n_reps)), initialize<span class="op">=</span><span class="va">True</span>, debug<span class="op">=</span><span class="va">True</span>, parallel<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ms</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The Starsim framework has been integrated with the Optuna hyperparameter optimization algorithm to facilitate calibration through the <a href="../api/calibration.html#starsim.calibration.Calibration" title="0"><code>Calibration</code></a> class. Recall that an optimization-based approach to calibration minimizes a function of the input parameters. This function is key to achieving an acceptable calibration.</p>
<p>There are two ways to describe the goodness-of-fit function for the <a href="../api/calibration.html#starsim.calibration.Calibration" title="0"><code>Calibration</code></a>. The first method is to directly provide a function that the algorithm will call. The <code>eval_fn</code> will be passed each completed <a href="../api/sim.html#starsim.sim" title="0"><code>sim</code></a> after running, and is expected to return a float representing the <strong>mismatch (lower is better as the optimization algorithm is configured to minimize)</strong>. Data can be passed into the <code>eval_fn</code> via <code>eval_kwargs</code>.</p>
<p>As an alternative to directly specifying the evaluation function, you can use <a href="../api/calibration.html#starsim.calibration.CalibComponent" title="0"><code>CalibComponent</code></a>s. Each component includes real data, for example from a survey, that is compared against simulation data from the model. Several components can be used at the same time, for example one for disease prevalence and another for treatment coverage. Each component computes a likelihood of the data given the input parameters, as assessed via simulation. Components are combined assuming independence.</p>
<p>The base class for a component is called <a href="../api/calibration.html#starsim.calibration.CalibComponent" title="0"><code>CalibComponent</code></a>, which you can use to define your own likelihood. However, we have provided components for several key likelihood functions including <code>BetaBinomial</code>, <code>Binomial</code>, <code>DirichletMultinomial</code>, <code>GammaPoisson</code>, and <code>Normal</code>. The <code>Normal</code> component is most like a traditional squared error. Each component takes in a <code>name</code> and a <code>weight</code>, which is used when combining log likelihoods.</p>
<p>Importantly, each component takes in the calibration target, the real data that was observed, in an argument called <code>expected</code>. This argument should be a Pandas Dataframe with one row per time point and columns that will depend on the specific component type. For example, the <code>Binomial</code> component requires columns of <code>n</code> (trials) and <code>x</code> (successes).</p>
<p>The components also handle extracting data from each simulation using the <code>extract_fn</code> argument. The value of this argument should be a function that takes in a simulation and returns a Pandas DataFrame. The specifics of the columns will depend a bit on the type of component (e.g.&nbsp;<code>BetaBinomial</code> is different from <code>Normal</code>), but often looks like a simulated version of <code>expected</code>. We will see examples below.</p>
<p>We’ll also see how to use the <code>conform</code> argument, the purpose of which is to temporally align the simulation output to the real data. This argument works along with the <code>extract_fn</code> to produce the final simulation outputs that are used in the likelihood function. The conformer is a function that takes in the <code>expected</code> data you provided and the <code>actual</code> simulation result the comes out of the <code>extract_fn</code>. The conformers we have built in are as follows:</p>
<ul>
<li><a href="../api/calibration.html#starsim.calibration.step_containing" title="0"><code>step_containing</code></a>: Conform by simply choosing the simulated timestep that contains the time indicated in the real data (<code>expected</code>)</li>
<li><code>prevalent</code>: Interpolate the simulated timepoints to estimate the values that would have occurred at each real timepoint</li>
<li><code>incident</code>: While the two methods above capture the state of the model at a particular point in time (stocks), this component allows you to capture the behavior of the model over time (flows). Instead of just giving one time value, <code>t</code>, you’ll provide a second time value as well called <code>t1</code>. This conformer will add up events occurring between the two time points.</li>
</ul>
<p>Let’s make a Binomial component, as might be used to calibrate disease prevalence.</p>
<div id="cell-13" class="cell" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>prevalence <span class="op">=</span> ss.Normal(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    name <span class="op">=</span> <span class="st">'Disease prevalence'</span>,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    conform <span class="op">=</span> <span class="st">'prevalent'</span>,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    expected <span class="op">=</span> pd.DataFrame({</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">'x'</span>: [<span class="fl">0.13</span>, <span class="fl">0.16</span>, <span class="fl">0.06</span>],    <span class="co"># Prevalence of infection</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    }, index<span class="op">=</span>pd.Index([ss.date(d) <span class="cf">for</span> d <span class="kw">in</span> [<span class="st">'2020-01-12'</span>, <span class="st">'2020-01-25'</span>, <span class="st">'2020-02-02'</span>]], name<span class="op">=</span><span class="st">'t'</span>)), <span class="co"># On these dates</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    extract_fn <span class="op">=</span> <span class="kw">lambda</span> sim: pd.DataFrame({</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'x'</span>: sim.results.sir.prevalence,</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    }, index<span class="op">=</span>pd.Index(sim.results.timevec, name<span class="op">=</span><span class="st">'t'</span>)),</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># You can specify the variance as well, but it's optional (max likelihood estimates will be used if not provided)</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># This could be a single float or an array with the same shape as the expected values</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    sigma2 <span class="op">=</span> <span class="fl">0.05</span>, <span class="co"># e.g. (num_replicates/sigma2_model + 1/sigma2_data)^-1</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">#sigma2 = np.array([0.05, 0.25, 0.01])</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Finally, we can bring all the pieces together. We make a single base simulation and create an instance of a Starsim Calibration object. This object requires a few arguments, like the <code>calib_pars</code> and <a href="../api/sim.html#starsim.sim" title="0"><code>sim</code></a>. We also pass in the function that modifies the base <a href="../api/sim.html#starsim.sim" title="0"><code>sim</code></a>, here our <code>build_sim</code> function. No additional <code>build_kw</code> are required in this example.</p>
<p>We also pass in a list of <code>components</code>. Instead of using this “component-based” system, a user could simply provide an <code>eval_fn</code>, which takes in a completed sim an any <code>eval_kwargs</code> and returns a “mismatch” score to be minimized.</p>
<p>We can also specify the total number of trials to run, the number of parallel works, and a few other parameters.</p>
<div id="cell-15" class="cell" data-execution_count="6">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>sc.heading(<span class="st">'Beginning calibration'</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the sim and data</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>sim <span class="op">=</span> make_sim()</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the calibration</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>calib <span class="op">=</span> ss.Calibration(</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    calib_pars <span class="op">=</span> calib_pars,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    sim <span class="op">=</span> sim,</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    build_fn <span class="op">=</span> build_sim,</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    build_kw <span class="op">=</span> <span class="bu">dict</span>(n_reps<span class="op">=</span><span class="dv">3</span>), <span class="co"># Run 3 replicates for each parameter set</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    reseed <span class="op">=</span> <span class="va">True</span>, <span class="co"># If true, a different random seed will be provided to each configuration</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    components <span class="op">=</span> [prevalence],</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    total_trials <span class="op">=</span> <span class="dv">100</span>,</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    n_workers <span class="op">=</span> <span class="va">None</span>, <span class="co"># None indicates to use all available CPUs</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    die <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    debug <span class="op">=</span> debug, <span class="co"># Run in serial if True</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform the calibration</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>sc.printcyan(<span class="st">'</span><span class="ch">\n</span><span class="st">Peforming calibration...'</span>)</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>calib.calibrate()<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre><span class="ansi-cyan-fg">



—————————————————————

Beginning calibration

—————————————————————

</span>

<span class="ansi-cyan-fg">

Peforming calibration...</span>

Removed existing calibration file starsim_calibration.db

sqlite:///starsim_calibration.db
</pre>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[I 2025-10-12 16:19:49,140] A new study created in RDB with name: starsim_calibration
[I 2025-10-12 16:19:50,892] Trial 2 finished with value: -0.45406760357232273 and parameters: {'beta': 0.011737775873566225, 'init_prev': 0.012737865989423454, 'n_contacts': 2, 'rand_seed': 416462}. Best is trial 2 with value: -0.45406760357232273.
[I 2025-10-12 16:19:50,915] Trial 0 finished with value: -0.4632664924612116 and parameters: {'beta': 0.017802025236673548, 'init_prev': 0.016895609048391224, 'n_contacts': 3, 'rand_seed': 502219}. Best is trial 1 with value: -0.5167698257945449.
[I 2025-10-12 16:19:50,916] Trial 1 finished with value: -0.5167698257945449 and parameters: {'beta': 0.22224598179733915, 'init_prev': 0.049356258683401634, 'n_contacts': 4, 'rand_seed': 709398}. Best is trial 1 with value: -0.5167698257945449.
[I 2025-10-12 16:19:50,967] Trial 3 finished with value: -0.4639678813501006 and parameters: {'beta': 0.08147479812775878, 'init_prev': 0.01766517883158681, 'n_contacts': 4, 'rand_seed': 207836}. Best is trial 1 with value: -0.5167698257945449.
[I 2025-10-12 16:19:51,887] Trial 6 finished with value: -0.4662989924612117 and parameters: {'beta': 0.1231937857148848, 'init_prev': 0.018649718293793693, 'n_contacts': 8, 'rand_seed': 729718}. Best is trial 1 with value: -0.5167698257945449.
[I 2025-10-12 16:19:51,891] Trial 5 finished with value: -0.47130843690565605 and parameters: {'beta': 0.07191219997103282, 'init_prev': 0.021474415591789038, 'n_contacts': 6, 'rand_seed': 870904}. Best is trial 1 with value: -0.5167698257945449.
[I 2025-10-12 16:19:51,896] Trial 4 finished with value: -0.4562989924612116 and parameters: {'beta': 0.022353643997378974, 'init_prev': 0.014015365395722963, 'n_contacts': 10, 'rand_seed': 443266}. Best is trial 1 with value: -0.5167698257945449.
[I 2025-10-12 16:19:52,028] Trial 7 finished with value: -0.519802325794545 and parameters: {'beta': 0.03318953018529719, 'init_prev': 0.04939516693136623, 'n_contacts': 10, 'rand_seed': 226303}. Best is trial 7 with value: -0.519802325794545.
[I 2025-10-12 16:19:52,787] Trial 8 finished with value: -0.4856581591278783 and parameters: {'beta': 0.014892421384598094, 'init_prev': 0.029110245931570612, 'n_contacts': 5, 'rand_seed': 3042}. Best is trial 7 with value: -0.519802325794545.
[I 2025-10-12 16:19:52,796] Trial 9 finished with value: -0.4956173257945449 and parameters: {'beta': 0.08058758688504011, 'init_prev': 0.034706660152235884, 'n_contacts': 7, 'rand_seed': 486125}. Best is trial 7 with value: -0.519802325794545.
[I 2025-10-12 16:19:52,915] Trial 10 finished with value: -0.5173839924612117 and parameters: {'beta': 0.06084638073983225, 'init_prev': 0.047677513898178064, 'n_contacts': 5, 'rand_seed': 585969}. Best is trial 7 with value: -0.519802325794545.
[I 2025-10-12 16:19:52,979] Trial 11 finished with value: -0.49381815912787835 and parameters: {'beta': 0.17568602181191662, 'init_prev': 0.03405000439222027, 'n_contacts': 4, 'rand_seed': 162145}. Best is trial 7 with value: -0.519802325794545.
[I 2025-10-12 16:19:53,758] Trial 12 finished with value: -0.5144662146834338 and parameters: {'beta': 0.036771973123908, 'init_prev': 0.04974686356421751, 'n_contacts': 10, 'rand_seed': 168173}. Best is trial 7 with value: -0.519802325794545.
[I 2025-10-12 16:19:53,794] Trial 13 finished with value: -0.5142414924612115 and parameters: {'beta': 0.035628052370353804, 'init_prev': 0.049119877398130306, 'n_contacts': 10, 'rand_seed': 161494}. Best is trial 7 with value: -0.519802325794545.
[I 2025-10-12 16:19:53,900] Trial 14 finished with value: -0.5123942702389894 and parameters: {'beta': 0.033873084544773266, 'init_prev': 0.04769538939539521, 'n_contacts': 10, 'rand_seed': 244882}. Best is trial 7 with value: -0.519802325794545.
[I 2025-10-12 16:19:53,972] Trial 15 finished with value: -0.5119264924612116 and parameters: {'beta': 0.033729516349971886, 'init_prev': 0.0475331774390259, 'n_contacts': 10, 'rand_seed': 286240}. Best is trial 7 with value: -0.519802325794545.
[I 2025-10-12 16:19:54,964] Trial 16 finished with value: -0.5024614924612116 and parameters: {'beta': 0.037040756929928725, 'init_prev': 0.042710185424427824, 'n_contacts': 9, 'rand_seed': 630904}. Best is trial 7 with value: -0.519802325794545.
[I 2025-10-12 16:19:54,980] Trial 17 finished with value: -0.5005726035723227 and parameters: {'beta': 0.038999957313932514, 'init_prev': 0.04199689593103507, 'n_contacts': 8, 'rand_seed': 305898}. Best is trial 7 with value: -0.519802325794545.
[I 2025-10-12 16:19:55,100] Trial 18 finished with value: -0.4992801035723228 and parameters: {'beta': 0.04605378323923469, 'init_prev': 0.041429340597621336, 'n_contacts': 8, 'rand_seed': 607620}. Best is trial 7 with value: -0.519802325794545.
[I 2025-10-12 16:19:55,160] Trial 19 finished with value: -0.4996087146834339 and parameters: {'beta': 0.05662001669099019, 'init_prev': 0.04121036781893249, 'n_contacts': 7, 'rand_seed': 685191}. Best is trial 7 with value: -0.519802325794545.
[I 2025-10-12 16:19:55,898] Trial 20 finished with value: -0.5070978813501006 and parameters: {'beta': 0.05176153605788078, 'init_prev': 0.04167480922763964, 'n_contacts': 6, 'rand_seed': 979385}. Best is trial 7 with value: -0.519802325794545.
[I 2025-10-12 16:19:55,915] Trial 21 finished with value: -0.5073303813501006 and parameters: {'beta': 0.05173029618731916, 'init_prev': 0.04197157854914958, 'n_contacts': 6, 'rand_seed': 926529}. Best is trial 7 with value: -0.519802325794545.
[I 2025-10-12 16:19:56,052] Trial 22 finished with value: -0.5059703813501005 and parameters: {'beta': 0.117162823124222, 'init_prev': 0.03812822929284299, 'n_contacts': 6, 'rand_seed': 950624}. Best is trial 7 with value: -0.519802325794545.
[I 2025-10-12 16:19:56,110] Trial 23 finished with value: -0.5010703813501006 and parameters: {'beta': 0.023200186552480344, 'init_prev': 0.0364986804431781, 'n_contacts': 6, 'rand_seed': 948731}. Best is trial 7 with value: -0.519802325794545.
[I 2025-10-12 16:19:56,835] Trial 24 finished with value: -0.5177812146834339 and parameters: {'beta': 0.2906751882096021, 'init_prev': 0.0453424925607449, 'n_contacts': 4, 'rand_seed': 812218}. Best is trial 7 with value: -0.519802325794545.
[I 2025-10-12 16:19:56,852] Trial 25 finished with value: -0.5158942702389894 and parameters: {'beta': 0.2165482874765136, 'init_prev': 0.04504846554695714, 'n_contacts': 4, 'rand_seed': 756986}. Best is trial 7 with value: -0.519802325794545.
[I 2025-10-12 16:19:57,007] Trial 26 finished with value: -0.5165267702389894 and parameters: {'beta': 0.24595198686992342, 'init_prev': 0.04592964419380786, 'n_contacts': 4, 'rand_seed': 734208}. Best is trial 7 with value: -0.519802325794545.
[I 2025-10-12 16:19:57,068] Trial 27 finished with value: -0.5161067702389894 and parameters: {'beta': 0.2163983207269254, 'init_prev': 0.04566995602676186, 'n_contacts': 4, 'rand_seed': 798534}. Best is trial 7 with value: -0.519802325794545.
[I 2025-10-12 16:19:57,740] Trial 28 finished with value: -0.4796487146834339 and parameters: {'beta': 0.2833070693802792, 'init_prev': 0.02937359750904532, 'n_contacts': 2, 'rand_seed': 559720}. Best is trial 7 with value: -0.519802325794545.
[I 2025-10-12 16:19:57,783] Trial 29 finished with value: -0.47258510357232275 and parameters: {'beta': 0.28891582119649845, 'init_prev': 0.025914183428814408, 'n_contacts': 2, 'rand_seed': 816383}. Best is trial 7 with value: -0.519802325794545.
[I 2025-10-12 16:19:57,936] Trial 30 finished with value: -0.4796487146834339 and parameters: {'beta': 0.1444337964475271, 'init_prev': 0.02968706274221222, 'n_contacts': 2, 'rand_seed': 835065}. Best is trial 7 with value: -0.519802325794545.
[I 2025-10-12 16:19:58,018] Trial 31 finished with value: -0.4796978813501005 and parameters: {'beta': 0.12676429905849657, 'init_prev': 0.028219632269580658, 'n_contacts': 5, 'rand_seed': 566340}. Best is trial 7 with value: -0.519802325794545.
[I 2025-10-12 16:19:58,657] Trial 32 finished with value: -0.47723760357232275 and parameters: {'beta': 0.025745590158165108, 'init_prev': 0.023327141398955545, 'n_contacts': 3, 'rand_seed': 365630}. Best is trial 7 with value: -0.519802325794545.
[I 2025-10-12 16:19:58,732] Trial 33 finished with value: -0.507202325794545 and parameters: {'beta': 0.025046878480295683, 'init_prev': 0.0393045175835651, 'n_contacts': 3, 'rand_seed': 363806}. Best is trial 7 with value: -0.519802325794545.
[I 2025-10-12 16:19:58,900] Trial 34 finished with value: -0.515932325794545 and parameters: {'beta': 0.02617737773804141, 'init_prev': 0.044377546062788355, 'n_contacts': 5, 'rand_seed': 375767}. Best is trial 7 with value: -0.519802325794545.
[I 2025-10-12 16:19:58,942] Trial 35 finished with value: -0.5240859369056561 and parameters: {'beta': 0.17186545843247536, 'init_prev': 0.049781364279651505, 'n_contacts': 3, 'rand_seed': 398142}. Best is trial 35 with value: -0.5240859369056561.
[I 2025-10-12 16:19:59,574] Trial 36 finished with value: -0.514189825794545 and parameters: {'beta': 0.010662876806072443, 'init_prev': 0.0497668208094325, 'n_contacts': 3, 'rand_seed': 681152}. Best is trial 35 with value: -0.5240859369056561.
[I 2025-10-12 16:19:59,700] Trial 37 finished with value: -0.507464825794545 and parameters: {'beta': 0.1657044930896618, 'init_prev': 0.044119852087622036, 'n_contacts': 5, 'rand_seed': 645671}. Best is trial 35 with value: -0.5240859369056561.
[I 2025-10-12 16:19:59,841] Trial 38 finished with value: -0.514189825794545 and parameters: {'beta': 0.010194065801465431, 'init_prev': 0.04974166299597011, 'n_contacts': 3, 'rand_seed': 659682}. Best is trial 35 with value: -0.5240859369056561.
[I 2025-10-12 16:19:59,866] Trial 39 finished with value: -0.5161673257945449 and parameters: {'beta': 0.16969825317900405, 'init_prev': 0.049876138458530575, 'n_contacts': 3, 'rand_seed': 63094}. Best is trial 35 with value: -0.5240859369056561.
[I 2025-10-12 16:20:00,527] Trial 40 finished with value: -0.5130962146834339 and parameters: {'beta': 0.17472412102402102, 'init_prev': 0.04688303764614466, 'n_contacts': 5, 'rand_seed': 34466}. Best is trial 35 with value: -0.5240859369056561.
[I 2025-10-12 16:20:00,641] Trial 41 finished with value: -0.5121992702389895 and parameters: {'beta': 0.09968846548010314, 'init_prev': 0.04731425856614599, 'n_contacts': 3, 'rand_seed': 25471}. Best is trial 35 with value: -0.5240859369056561.
[I 2025-10-12 16:20:00,826] Trial 43 finished with value: -0.5134845480167674 and parameters: {'beta': 0.09726586899252225, 'init_prev': 0.04724086503519015, 'n_contacts': 7, 'rand_seed': 479949}. Best is trial 35 with value: -0.5240859369056561.
[I 2025-10-12 16:20:00,838] Trial 42 finished with value: -0.5137417702389895 and parameters: {'beta': 0.10606305086366213, 'init_prev': 0.04712882422341095, 'n_contacts': 7, 'rand_seed': 443757}. Best is trial 35 with value: -0.5240859369056561.
[I 2025-10-12 16:20:01,471] Trial 44 finished with value: -0.4480192702389894 and parameters: {'beta': 0.10656373945846494, 'init_prev': 0.010258675914808363, 'n_contacts': 4, 'rand_seed': 503601}. Best is trial 35 with value: -0.5240859369056561.
[I 2025-10-12 16:20:01,599] Trial 45 finished with value: -0.49385704801676716 and parameters: {'beta': 0.21385864943244154, 'init_prev': 0.03261748167155197, 'n_contacts': 4, 'rand_seed': 469755}. Best is trial 35 with value: -0.5240859369056561.
[I 2025-10-12 16:20:01,781] Trial 46 finished with value: -0.5152720480167672 and parameters: {'beta': 0.21001811456684943, 'init_prev': 0.04376442819737622, 'n_contacts': 4, 'rand_seed': 548526}. Best is trial 35 with value: -0.5240859369056561.
[I 2025-10-12 16:20:01,783] Trial 47 finished with value: -0.5138728813501005 and parameters: {'beta': 0.0173460479510526, 'init_prev': 0.04523719209343611, 'n_contacts': 4, 'rand_seed': 538917}. Best is trial 35 with value: -0.5240859369056561.
[I 2025-10-12 16:20:02,419] Trial 48 finished with value: -0.5165339924612117 and parameters: {'beta': 0.013488578007271997, 'init_prev': 0.04359029201410858, 'n_contacts': 4, 'rand_seed': 549488}. Best is trial 35 with value: -0.5240859369056561.
[I 2025-10-12 16:20:02,591] Trial 49 finished with value: -0.5180614924612116 and parameters: {'beta': 0.01782182790305289, 'init_prev': 0.044405656479142006, 'n_contacts': 9, 'rand_seed': 875030}. Best is trial 35 with value: -0.5240859369056561.
[I 2025-10-12 16:20:02,783] Trial 51 finished with value: -0.5125478813501005 and parameters: {'beta': 0.0788934859235003, 'init_prev': 0.039770137166364156, 'n_contacts': 9, 'rand_seed': 123639}. Best is trial 35 with value: -0.5240859369056561.
[I 2025-10-12 16:20:02,793] Trial 50 finished with value: -0.5230798257945449 and parameters: {'beta': 0.06976017352147351, 'init_prev': 0.04819932143446065, 'n_contacts': 9, 'rand_seed': 872774}. Best is trial 35 with value: -0.5240859369056561.
[I 2025-10-12 16:20:03,408] Trial 52 finished with value: -0.5044281591278783 and parameters: {'beta': 0.06969346373958976, 'init_prev': 0.03972455501705389, 'n_contacts': 5, 'rand_seed': 879112}. Best is trial 35 with value: -0.5240859369056561.
[I 2025-10-12 16:20:03,607] Trial 53 finished with value: -0.5063026035723227 and parameters: {'beta': 0.0700691565511938, 'init_prev': 0.04010147114178331, 'n_contacts': 9, 'rand_seed': 888355}. Best is trial 35 with value: -0.5240859369056561.
[I 2025-10-12 16:20:03,759] Trial 54 finished with value: -0.5154684369056561 and parameters: {'beta': 0.06703616976158991, 'init_prev': 0.04795924521898377, 'n_contacts': 9, 'rand_seed': 769315}. Best is trial 35 with value: -0.5240859369056561.
[I 2025-10-12 16:20:03,774] Trial 55 finished with value: -0.5157187146834339 and parameters: {'beta': 0.0666737248363984, 'init_prev': 0.04858316594150869, 'n_contacts': 9, 'rand_seed': 900119}. Best is trial 35 with value: -0.5240859369056561.
[I 2025-10-12 16:20:04,426] Trial 56 finished with value: -0.5142551035723227 and parameters: {'beta': 0.059364739492709866, 'init_prev': 0.04800260378485961, 'n_contacts': 9, 'rand_seed': 999409}. Best is trial 35 with value: -0.5240859369056561.
[I 2025-10-12 16:20:04,610] Trial 57 finished with value: -0.5144731591278783 and parameters: {'beta': 0.06244336364284383, 'init_prev': 0.04849000702928664, 'n_contacts': 9, 'rand_seed': 761656}. Best is trial 35 with value: -0.5240859369056561.
[I 2025-10-12 16:20:04,746] Trial 58 finished with value: -0.5121039924612115 and parameters: {'beta': 0.03020819385648629, 'init_prev': 0.045442099433159217, 'n_contacts': 10, 'rand_seed': 247461}. Best is trial 35 with value: -0.5240859369056561.
[I 2025-10-12 16:20:04,760] Trial 59 finished with value: -0.5125789924612116 and parameters: {'beta': 0.030665037145438143, 'init_prev': 0.045985222134102034, 'n_contacts': 10, 'rand_seed': 277228}. Best is trial 35 with value: -0.5240859369056561.
[I 2025-10-12 16:20:05,429] Trial 60 finished with value: -0.5108334369056561 and parameters: {'beta': 0.04370331730406773, 'init_prev': 0.046046069941700796, 'n_contacts': 10, 'rand_seed': 259578}. Best is trial 35 with value: -0.5240859369056561.
[I 2025-10-12 16:20:05,618] Trial 61 finished with value: -0.4593414924612116 and parameters: {'beta': 0.030578027109251796, 'init_prev': 0.01592982828926128, 'n_contacts': 10, 'rand_seed': 322374}. Best is trial 35 with value: -0.5240859369056561.
[I 2025-10-12 16:20:05,726] Trial 62 finished with value: -0.5043134369056561 and parameters: {'beta': 0.041314336311224435, 'init_prev': 0.04247096505448464, 'n_contacts': 8, 'rand_seed': 856316}. Best is trial 35 with value: -0.5240859369056561.
[I 2025-10-12 16:20:05,753] Trial 63 finished with value: -0.4590870480167672 and parameters: {'beta': 0.04386373459182947, 'init_prev': 0.015837408854677913, 'n_contacts': 8, 'rand_seed': 836939}. Best is trial 35 with value: -0.5240859369056561.
[I 2025-10-12 16:20:06,374] Trial 64 finished with value: -0.4551217702389894 and parameters: {'beta': 0.019214433639632017, 'init_prev': 0.01597394834807063, 'n_contacts': 5, 'rand_seed': 602158}. Best is trial 35 with value: -0.5240859369056561.
[I 2025-10-12 16:20:06,593] Trial 65 finished with value: -0.5087726035723228 and parameters: {'beta': 0.020146959367389115, 'init_prev': 0.043369252765647355, 'n_contacts': 8, 'rand_seed': 846917}. Best is trial 35 with value: -0.5240859369056561.
[I 2025-10-12 16:20:06,702] Trial 66 finished with value: -0.5159878813501005 and parameters: {'beta': 0.020112149230918263, 'init_prev': 0.04898368275915769, 'n_contacts': 8, 'rand_seed': 726657}. Best is trial 35 with value: -0.5240859369056561.
[I 2025-10-12 16:20:06,751] Trial 67 finished with value: -0.5185481591278784 and parameters: {'beta': 0.2560570182670408, 'init_prev': 0.04858652690092504, 'n_contacts': 5, 'rand_seed': 720033}. Best is trial 35 with value: -0.5240859369056561.
[I 2025-10-12 16:20:07,344] Trial 68 finished with value: -0.5104917702389894 and parameters: {'beta': 0.25423668883282635, 'init_prev': 0.04294336553235291, 'n_contacts': 6, 'rand_seed': 714547}. Best is trial 35 with value: -0.5240859369056561.
[I 2025-10-12 16:20:07,577] Trial 69 finished with value: -0.5194662146834338 and parameters: {'beta': 0.2573337861470101, 'init_prev': 0.0491694153879713, 'n_contacts': 6, 'rand_seed': 210050}. Best is trial 35 with value: -0.5240859369056561.
[I 2025-10-12 16:20:07,647] Trial 70 finished with value: -0.5146278813501006 and parameters: {'beta': 0.253703349405228, 'init_prev': 0.046687470827739365, 'n_contacts': 3, 'rand_seed': 713688}. Best is trial 35 with value: -0.5240859369056561.
[I 2025-10-12 16:20:07,730] Trial 71 finished with value: -0.504512325794545 and parameters: {'beta': 0.24710040875298064, 'init_prev': 0.03754053963237768, 'n_contacts': 5, 'rand_seed': 916165}. Best is trial 35 with value: -0.5240859369056561.
[I 2025-10-12 16:20:08,310] Trial 72 finished with value: -0.5100234369056561 and parameters: {'beta': 0.2475589545607313, 'init_prev': 0.04613581253831235, 'n_contacts': 5, 'rand_seed': 793523}. Best is trial 35 with value: -0.5240859369056561.
[I 2025-10-12 16:20:08,573] Trial 73 finished with value: -0.5162948257945449 and parameters: {'beta': 0.2476745063195732, 'init_prev': 0.04999887672170644, 'n_contacts': 6, 'rand_seed': 189355}. Best is trial 35 with value: -0.5240859369056561.
[I 2025-10-12 16:20:08,625] Trial 74 finished with value: -0.5120231591278783 and parameters: {'beta': 0.19433979918382077, 'init_prev': 0.04888414742072204, 'n_contacts': 6, 'rand_seed': 198332}. Best is trial 35 with value: -0.5240859369056561.
[I 2025-10-12 16:20:08,723] Trial 75 finished with value: -0.5122389924612116 and parameters: {'beta': 0.19558471867798893, 'init_prev': 0.04908030614406735, 'n_contacts': 6, 'rand_seed': 205728}. Best is trial 35 with value: -0.5240859369056561.
[I 2025-10-12 16:20:09,283] Trial 76 finished with value: -0.517662325794545 and parameters: {'beta': 0.1947453088876372, 'init_prev': 0.048945091740197365, 'n_contacts': 6, 'rand_seed': 185429}. Best is trial 35 with value: -0.5240859369056561.
[I 2025-10-12 16:20:09,566] Trial 77 finished with value: -0.5186806591278782 and parameters: {'beta': 0.19373504197733024, 'init_prev': 0.048897945781872856, 'n_contacts': 7, 'rand_seed': 203845}. Best is trial 35 with value: -0.5240859369056561.
[I 2025-10-12 16:20:09,644] Trial 78 finished with value: -0.5146973257945449 and parameters: {'beta': 0.2971292747895717, 'init_prev': 0.0446965608322469, 'n_contacts': 7, 'rand_seed': 405963}. Best is trial 35 with value: -0.5240859369056561.
[I 2025-10-12 16:20:09,750] Trial 79 finished with value: -0.5149270480167671 and parameters: {'beta': 0.29278096915077634, 'init_prev': 0.0447270708070549, 'n_contacts': 7, 'rand_seed': 951542}. Best is trial 35 with value: -0.5240859369056561.
[I 2025-10-12 16:20:10,533] Trial 80 finished with value: -0.516982325794545 and parameters: {'beta': 0.2815596915024906, 'init_prev': 0.04441353396592527, 'n_contacts': 7, 'rand_seed': 136186}. Best is trial 35 with value: -0.5240859369056561.
[I 2025-10-12 16:20:10,591] Trial 82 finished with value: -0.5197753813501005 and parameters: {'beta': 0.1497602105823099, 'init_prev': 0.048070721386038545, 'n_contacts': 7, 'rand_seed': 135133}. Best is trial 35 with value: -0.5240859369056561.
[I 2025-10-12 16:20:10,806] Trial 83 finished with value: -0.524517325794545 and parameters: {'beta': 0.2644668338889264, 'init_prev': 0.04778420160079449, 'n_contacts': 10, 'rand_seed': 124587}. Best is trial 83 with value: -0.524517325794545.
[I 2025-10-12 16:20:10,808] Trial 81 finished with value: -0.517318436905656 and parameters: {'beta': 0.29988747190148457, 'init_prev': 0.04471744914861839, 'n_contacts': 7, 'rand_seed': 119271}. Best is trial 83 with value: -0.524517325794545.
[I 2025-10-12 16:20:11,473] Trial 84 finished with value: -0.5135328813501006 and parameters: {'beta': 0.13682115345694407, 'init_prev': 0.04796479742979259, 'n_contacts': 7, 'rand_seed': 100709}. Best is trial 83 with value: -0.524517325794545.
[I 2025-10-12 16:20:11,777] Trial 85 finished with value: -0.5129545480167672 and parameters: {'beta': 0.15240409428254184, 'init_prev': 0.04710886952306404, 'n_contacts': 7, 'rand_seed': 228154}. Best is trial 83 with value: -0.524517325794545.
[I 2025-10-12 16:20:11,808] Trial 87 finished with value: -0.518626214683434 and parameters: {'beta': 0.2292087507629732, 'init_prev': 0.0474508394083677, 'n_contacts': 10, 'rand_seed': 77947}. Best is trial 83 with value: -0.524517325794545.
[I 2025-10-12 16:20:12,066] Trial 86 finished with value: -0.5174462146834339 and parameters: {'beta': 0.1586276431760922, 'init_prev': 0.04783226123870313, 'n_contacts': 10, 'rand_seed': 90202}. Best is trial 83 with value: -0.524517325794545.
[I 2025-10-12 16:20:12,513] Trial 88 finished with value: -0.5224823257945449 and parameters: {'beta': 0.15727065897433853, 'init_prev': 0.04691442257770579, 'n_contacts': 10, 'rand_seed': 75952}. Best is trial 83 with value: -0.524517325794545.
[I 2025-10-12 16:20:12,792] Trial 89 finished with value: -0.4749192702389894 and parameters: {'beta': 0.15352084957728365, 'init_prev': 0.02020499367695555, 'n_contacts': 10, 'rand_seed': 72318}. Best is trial 83 with value: -0.524517325794545.
[I 2025-10-12 16:20:12,851] Trial 90 finished with value: -0.5248903813501005 and parameters: {'beta': 0.1499662544027201, 'init_prev': 0.04991582334534988, 'n_contacts': 10, 'rand_seed': 85240}. Best is trial 90 with value: -0.5248903813501005.
[I 2025-10-12 16:20:13,127] Trial 91 finished with value: -0.5287876035723227 and parameters: {'beta': 0.22729929957395315, 'init_prev': 0.04992055627826883, 'n_contacts': 10, 'rand_seed': 157438}. Best is trial 91 with value: -0.5287876035723227.
[I 2025-10-12 16:20:13,527] Trial 92 finished with value: -0.48043899246121163 and parameters: {'beta': 0.13148729872594683, 'init_prev': 0.020671326640560005, 'n_contacts': 10, 'rand_seed': 158423}. Best is trial 91 with value: -0.5287876035723227.
[I 2025-10-12 16:20:13,840] Trial 93 finished with value: -0.5217495480167672 and parameters: {'beta': 0.230109127491939, 'init_prev': 0.04663680395296568, 'n_contacts': 10, 'rand_seed': 155376}. Best is trial 91 with value: -0.5287876035723227.
[I 2025-10-12 16:20:13,880] Trial 94 finished with value: -0.5169103813501005 and parameters: {'beta': 0.12904385630662954, 'init_prev': 0.04666476854667605, 'n_contacts': 10, 'rand_seed': 150974}. Best is trial 91 with value: -0.5287876035723227.
[I 2025-10-12 16:20:14,145] Trial 95 finished with value: -0.5249956591278784 and parameters: {'beta': 0.18368772887151447, 'init_prev': 0.04987543132468288, 'n_contacts': 10, 'rand_seed': 156095}. Best is trial 91 with value: -0.5287876035723227.
[I 2025-10-12 16:20:14,538] Trial 96 finished with value: -0.5261776035723228 and parameters: {'beta': 0.18925504744322974, 'init_prev': 0.04992158040011575, 'n_contacts': 10, 'rand_seed': 33891}. Best is trial 91 with value: -0.5287876035723227.
[I 2025-10-12 16:20:14,755] Trial 97 finished with value: -0.5258401035723228 and parameters: {'beta': 0.17548851534473853, 'init_prev': 0.04988325732715947, 'n_contacts': 10, 'rand_seed': 46613}. Best is trial 91 with value: -0.5287876035723227.
[I 2025-10-12 16:20:14,907] Trial 98 finished with value: -0.5247184369056561 and parameters: {'beta': 0.11793383815736394, 'init_prev': 0.04946476880807346, 'n_contacts': 10, 'rand_seed': 52608}. Best is trial 91 with value: -0.5287876035723227.
[I 2025-10-12 16:20:15,071] Trial 99 finished with value: -0.5259573257945449 and parameters: {'beta': 0.18195815158478346, 'init_prev': 0.049804815466459464, 'n_contacts': 10, 'rand_seed': 52586}. Best is trial 91 with value: -0.5287876035723227.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Making results structure...
Processed 100 trials; 0 failed
Best pars: {'beta': 0.22729929957395315, 'init_prev': 0.04992055627826883, 'n_contacts': 10, 'rand_seed': 157438}
Removed existing calibration file starsim_calibration.db</code></pre>
</div>
</div>
<p>Let’s look at the best parameters that were found. Note that the <code>rand_seed</code> was selected at random, but the other parameters are meaningful.</p>
<div id="cell-17" class="cell" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>calib.best_pars</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>{'beta': 0.22729929957395315,
 'init_prev': 0.04992055627826883,
 'n_contacts': 10,
 'rand_seed': 157438}</code></pre>
</div>
</div>
<p>Once the calibration is complete, we can compare the <code>guess</code> values to the best values found by calling <code>check_fit</code>.</p>
<div id="cell-19" class="cell" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Confirm - Note the comparison is here configured over n_reps=15 replicates</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>sc.printcyan(<span class="st">'</span><span class="ch">\n</span><span class="st">Confirming fit...'</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Increase replicates to 15 for more representative results when running check_fit</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>calib.build_kw[<span class="st">'n_reps'</span>] <span class="op">=</span> <span class="dv">15</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>calib.check_fit(do_plot<span class="op">=</span><span class="va">False</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre><span class="ansi-cyan-fg">

Confirming fit...</span>

<span class="ansi-cyan-fg">

Checking fit...</span>
</pre>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Exception ignored in: &lt;_io.BytesIO object at 0x7fd2911ae610&gt;
Traceback (most recent call last):
  File "/home/runner/work/starsim/starsim/starsim/time.py", line 259, in _rebuild
    @staticmethod
BufferError: Existing exports of data: object cannot be re-sized
Exception ignored in: &lt;_io.BytesIO object at 0x7fd2912bc720&gt;
Traceback (most recent call last):
  File "/opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/dill/_dill.py", line 986, in _create_array
    array.__dict__.update(npdict)
BufferError: Existing exports of data: object cannot be re-sized
Exception ignored in: &lt;_io.BytesIO object at 0x7fd290ae43b0&gt;
Traceback (most recent call last):
  File "/home/runner/work/starsim/starsim/starsim/time.py", line 873, in __new__
    def __new__(cls, value=None, base=None, **kwargs):
BufferError: Existing exports of data: object cannot be re-sized</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Fit with original pars: -0.5477262702389893
Fit with best-fit pars: -0.5238718813501005
✗ Calibration did not improve fit as the objective got worse (-0.5477262702389893 --&gt; -0.5238718813501005), but this sometimes happens stochastically and is not necessarily an error</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>False</code></pre>
</div>
</div>
<p>After calling <code>check_fit</code>, we can plot the results. This first plot shows the Normal likelihood distributions from each of the 15 simulations we did in <code>check_fit</code> as the colored lines. The vertical dashed line is located at the real (<code>expected</code>) data. Top row is the “guess” values and the bottom row is the new “best” parameters. We want the vertical dashed line to cross the Gaussians at high points, representing high likelihood.</p>
<div id="cell-21" class="cell" data-execution_count="9">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>calib.plot()<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Exception ignored in: &lt;_io.BytesIO object at 0x7fd2909e17b0&gt;
Traceback (most recent call last):
  File "&lt;frozen importlib._bootstrap_external&gt;", line 784, in _compile_bytecode
BufferError: Existing exports of data: object cannot be re-sized</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="workflows_calibration_files/figure-html/cell-10-output-2.png" width="1286" height="569" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Another way to plot the results is via bootstrapping. Here we repeatedly choose 15 from the <code>n_reps=15</code> simulations (with replacement), compute the average (or sum for some components), and repeatedly calculate the mean. We then plot the distribution of means, and hope it lands near the vertical dashed lines representing the real data.</p>
<div id="cell-23" class="cell" data-execution_count="10">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>calib.plot(bootstrap<span class="op">=</span><span class="va">True</span>)<span class="op">;</span> <span class="co"># Pass bootstrap=True to produce this plot</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Exception ignored in: &lt;_io.BytesIO object at 0x7fd251fc0f90&gt;
Traceback (most recent call last):
  File "/opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/matplotlib/_api/__init__.py", line 126, in check_in_list
    if val not in values:
BufferError: Existing exports of data: object cannot be re-sized</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="workflows_calibration_files/figure-html/cell-11-output-2.png" width="1286" height="569" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We can view some plots of the final fitted results. Whereas the two plots above were from the <code>check_fit</code>, running both “guess” and “best” parameters, here we make make new simulations to visualize the results.</p>
<div id="cell-25" class="cell" data-execution_count="11">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> calib.plot_final()<span class="op">;</span> <span class="co"># Run the model for build_kw['n_reps'] = 15 replicates</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="workflows_calibration_files/figure-html/cell-12-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-26" class="cell" data-execution_count="12">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>calib</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>&lt;starsim.calibration.Calibration at 0x7fd25395e900&gt;
[&lt;class 'starsim.calibration.Calibration'&gt;, &lt;class 'sciris.sc_printing.prettyobj'&gt;]
————————————————————————————————————————————————————————————————————————
Methods:
  _eval_fit()             make_study()            run_sim()               
  _sample_from_trial()    parse_study()           run_trial()             
  build_fn()              plot()                  run_workers()           
  calibrate()             plot_final()            to_df()                 
  check_fit()             plot_optuna()           to_json()               
  eval_fn()               remove_db()             worker()                
————————————————————————————————————————————————————————————————————————
 after_fits: -0.5238718813501005
 after_msim: MultiSim(n_sims: 15; base: Sim(n=2000;
             2020.01.01—2020.02.12; not ini [...]
before_fits: -0.5477262702389893
before_msim: MultiSim(n_sims: 15; base: Sim(n=2000;
             2020.01.01—2020.02.12; not ini [...]
  best_pars: {'beta': 0.22729929957395315, 'init_prev':
             0.04992055627826883, 'n_co [...]
   build_fn: &lt;function build_sim at 0x7fd2539d14e0&gt;
   build_kw: {'n_reps': 15}
 calib_pars: {'beta': {'low': 0.01, 'high': 0.3, 'guess': 0.15,
             'suggest_type': 's [...]
 calibrated: True
 components: [Calibration component with name Disease prevalence]
         df:     index  mismatch      beta  init_prev  n_contacts
             rand_seed
             91    [...]
        die: True
    elapsed: 26.59641933441162
    eval_fn: &lt;bound method Calibration._eval_fit of
             &lt;starsim.calibration.Calibrati [...]
    eval_kw: {}
      label: None
   prune_fn: None
     reseed: True
   run_args: #0. 'n_trials':    25
             #1. 'n_workers':   4
             #2. 'debug':       False
             # [...]
        sim: Sim(n=2000; 2020.01.01—2020.02.12; not initialized)
      study: &lt;optuna.study.study.Study object at 0x7fd27a2fd550&gt;
 study_data: #0. 'index':      [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11,
             12, 13, 14,  [...]
    verbose: True
————————————————————————————————————————————————————————————————————————</code></pre>
</div>
</div>
<p>Optuna has lots of diagnostic plots that we can explore. Possible plots include:</p>
<ul>
<li>plot_contour</li>
<li>plot_edf</li>
<li>plot_hypervolume_history</li>
<li>plot_intermediate_values</li>
<li>plot_optimization_history</li>
<li>plot_parallel_coordinate</li>
<li>plot_param_importances</li>
<li>plot_pareto_front</li>
<li>plot_rank</li>
<li>plot_slice</li>
<li>plot_terminator_improvement</li>
<li>plot_timeline</li>
</ul>
<p>Here are some examples:</p>
<div id="cell-28" class="cell" data-execution_count="13">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>calib.plot_optuna(<span class="st">'plot_optimization_history'</span>)<span class="op">;</span> <span class="co"># Plot the optimization history</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>/home/runner/work/starsim/starsim/starsim/calibration.py:433: ExperimentalWarning: optuna.visualization.matplotlib._optimization_history.plot_optimization_history is experimental (supported from v2.2.0). The interface can change in the future.
  fig = getattr(vis, method)(self.study)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="workflows_calibration_files/figure-html/cell-14-output-2.png" width="795" height="454" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-29" class="cell" data-execution_count="14">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>calib.plot_optuna(<span class="st">'plot_contour'</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>/home/runner/work/starsim/starsim/starsim/calibration.py:433: ExperimentalWarning: optuna.visualization.matplotlib._contour.plot_contour is experimental (supported from v2.2.0). The interface can change in the future.
  fig = getattr(vis, method)(self.study)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="workflows_calibration_files/figure-html/cell-15-output-2.png" width="621" height="481" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-30" class="cell" data-execution_count="15">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>calib.plot_optuna(<span class="st">'plot_param_importances'</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Could not run plot_param_importances: Tried to import 'sklearn' but failed. Please make sure that the package is installed correctly to use this feature. Actual error: No module named 'sklearn'.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/home/runner/work/starsim/starsim/starsim/calibration.py:433: ExperimentalWarning: optuna.visualization.matplotlib._param_importances.plot_param_importances is experimental (supported from v2.2.0). The interface can change in the future.
  fig = getattr(vis, method)(self.study)</code></pre>
</div>
</div>
<p>If you choose not to use components, you can always create your own mismatch function, as in the following example:</p>
<div id="cell-32" class="cell" data-execution_count="16">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>my_data <span class="op">=</span> (ss.date(<span class="st">'2020-01-12'</span>), <span class="fl">0.13</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="bu">eval</span>(sim, expected):</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute the squared error at one point in time.</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># expected will contain my_data in this example due to eval_kw</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    date, p <span class="op">=</span> expected</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(sim, ss.MultiSim):</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>        sim <span class="op">=</span> ss.MultiSim(sims<span class="op">=</span>[sim])</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    ret <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> s <span class="kw">in</span> sim.sims:</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>        ind <span class="op">=</span> np.searchsorted(s.results.timevec, date, side<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>        prev <span class="op">=</span> s.results.sir.prevalence[ind]</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>        ret <span class="op">+=</span> (prev <span class="op">-</span> p)<span class="op">**</span><span class="dv">2</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ret</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the calibration parameters</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>calib_pars <span class="op">=</span> <span class="bu">dict</span>(</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>    beta <span class="op">=</span> <span class="bu">dict</span>(low<span class="op">=</span><span class="fl">0.01</span>, high<span class="op">=</span><span class="fl">0.30</span>, guess<span class="op">=</span><span class="fl">0.15</span>, suggest_type<span class="op">=</span><span class="st">'suggest_float'</span>, log<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the sim and data</span></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>sim <span class="op">=</span> make_sim()</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the calibration</span></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>calib <span class="op">=</span> ss.Calibration(</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>    calib_pars <span class="op">=</span> calib_pars,</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>    sim <span class="op">=</span> sim,</span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>    build_fn <span class="op">=</span> build_sim,</span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>    build_kw <span class="op">=</span> <span class="bu">dict</span>(n_reps<span class="op">=</span><span class="dv">2</span>), <span class="co"># Two reps per point</span></span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>    reseed <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>    eval_fn <span class="op">=</span> <span class="bu">eval</span>, <span class="co"># Will call my_function(msim, eval_kwargs)</span></span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>    eval_kw <span class="op">=</span> <span class="bu">dict</span>(expected<span class="op">=</span>my_data), <span class="co"># Will call eval(sim, **eval_kw)</span></span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>    total_trials <span class="op">=</span> <span class="dv">20</span>,</span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>    n_workers <span class="op">=</span> <span class="va">None</span>, <span class="co"># None indicates to use all available CPUs</span></span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a>    die <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a>    debug <span class="op">=</span> debug,</span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform the calibration</span></span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a>sc.printcyan(<span class="st">'</span><span class="ch">\n</span><span class="st">Peforming calibration...'</span>)</span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a>calib.calibrate()</span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Check</span></span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a>calib.check_fit()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>[I 2025-10-12 16:20:38,168] A new study created in RDB with name: starsim_calibration</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre><span class="ansi-cyan-fg">

Peforming calibration...</span>

Removed existing calibration file starsim_calibration.db

sqlite:///starsim_calibration.db
</pre>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[I 2025-10-12 16:20:38,982] Trial 0 finished with value: 0.023235250000000002 and parameters: {'beta': 0.09000351567266891, 'rand_seed': 866744}. Best is trial 0 with value: 0.023235250000000002.
[I 2025-10-12 16:20:38,984] Trial 1 finished with value: 0.023235250000000002 and parameters: {'beta': 0.054426300412347445, 'rand_seed': 300338}. Best is trial 0 with value: 0.023235250000000002.
[I 2025-10-12 16:20:39,024] Trial 2 finished with value: 0.023125 and parameters: {'beta': 0.20622440313012363, 'rand_seed': 334992}. Best is trial 2 with value: 0.023125.
[I 2025-10-12 16:20:39,034] Trial 3 finished with value: 0.023235250000000002 and parameters: {'beta': 0.06466122563889257, 'rand_seed': 438450}. Best is trial 2 with value: 0.023125.
[I 2025-10-12 16:20:39,602] Trial 4 finished with value: 0.023668250000000002 and parameters: {'beta': 0.0741623383519253, 'rand_seed': 864780}. Best is trial 2 with value: 0.023125.
[I 2025-10-12 16:20:39,614] Trial 5 finished with value: 0.023451250000000003 and parameters: {'beta': 0.2707707531449058, 'rand_seed': 144182}. Best is trial 2 with value: 0.023125.
[I 2025-10-12 16:20:39,647] Trial 6 finished with value: 0.023668250000000002 and parameters: {'beta': 0.021003719593789754, 'rand_seed': 425845}. Best is trial 2 with value: 0.023125.
[I 2025-10-12 16:20:39,666] Trial 7 finished with value: 0.023774500000000004 and parameters: {'beta': 0.01614224130971827, 'rand_seed': 78740}. Best is trial 2 with value: 0.023125.
[I 2025-10-12 16:20:40,217] Trial 8 finished with value: 0.024438500000000002 and parameters: {'beta': 0.01821432030625131, 'rand_seed': 761886}. Best is trial 2 with value: 0.023125.
[I 2025-10-12 16:20:40,235] Trial 9 finished with value: 0.024438500000000002 and parameters: {'beta': 0.037808218258283385, 'rand_seed': 116006}. Best is trial 2 with value: 0.023125.
[I 2025-10-12 16:20:40,272] Trial 10 finished with value: 0.023998500000000002 and parameters: {'beta': 0.19450027893472022, 'rand_seed': 167828}. Best is trial 2 with value: 0.023125.
[I 2025-10-12 16:20:40,290] Trial 11 finished with value: 0.023998500000000002 and parameters: {'beta': 0.2756600354257537, 'rand_seed': 159661}. Best is trial 2 with value: 0.023125.
[I 2025-10-12 16:20:40,838] Trial 12 finished with value: 0.02453225 and parameters: {'beta': 0.28379570368182183, 'rand_seed': 641887}. Best is trial 2 with value: 0.023125.
[I 2025-10-12 16:20:40,868] Trial 13 finished with value: 0.02453225 and parameters: {'beta': 0.24603310829796915, 'rand_seed': 615251}. Best is trial 2 with value: 0.023125.
[I 2025-10-12 16:20:40,907] Trial 14 finished with value: 0.024644 and parameters: {'beta': 0.1176459363451612, 'rand_seed': 662202}. Best is trial 2 with value: 0.023125.
[I 2025-10-12 16:20:40,924] Trial 15 finished with value: 0.024644 and parameters: {'beta': 0.13708105370687662, 'rand_seed': 708173}. Best is trial 2 with value: 0.023125.
[I 2025-10-12 16:20:41,878] Trial 16 finished with value: 0.024865 and parameters: {'beta': 0.12201806304403029, 'rand_seed': 988722}. Best is trial 2 with value: 0.023125.
[I 2025-10-12 16:20:41,884] Trial 17 finished with value: 0.024865 and parameters: {'beta': 0.1418488973992514, 'rand_seed': 969771}. Best is trial 2 with value: 0.023125.
[I 2025-10-12 16:20:41,907] Trial 18 finished with value: 0.024865 and parameters: {'beta': 0.11010309042004458, 'rand_seed': 998666}. Best is trial 2 with value: 0.023125.
[I 2025-10-12 16:20:41,918] Trial 19 finished with value: 0.024865 and parameters: {'beta': 0.12130896942898797, 'rand_seed': 951342}. Best is trial 2 with value: 0.023125.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre>Making results structure...

Processed 20 trials; 0 failed

Best pars: {'beta': 0.20622440313012363, 'rand_seed': 334992}

Removed existing calibration file starsim_calibration.db

<span class="ansi-cyan-fg">

Checking fit...</span>

Fit with original pars: 0.023125

Fit with best-fit pars: 0.023472250000000004

✗ Calibration did not improve fit as the objective got worse (0.023125 --&gt; 0.023472250000000004), but this sometimes happens stochastically and is not necessarily an error
</pre>
</div>
</div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>False</code></pre>
</div>
</div>
<p>For more, take a look at <code>test_calibration.py</code> in the <code>tests</code> directory.</p>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../user_guide/workflows_sir_calibration.html" class="pagination-link" aria-label="Fit stochastic SIR models to synthetic data">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Fit stochastic SIR models to synthetic data</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../user_guide/workflows_deploy.html" class="pagination-link" aria-label="Deployment">
        <span class="nav-page-text">Deployment</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>The docs were built for Starsim v3.0.3 (2025-10-07).<br>© 2023–2025, Gates Foundation. All rights reserved. <a href="https://www.gatesfoundation.org/Privacy-and-Cookies-Notice">Privacy and Cookies Notice</a> | <a href="https://www.gatesfoundation.org/Terms-of-Use">Terms of Use</a></p>
<div class="toc-actions"><ul><li><a href="https://github.com/starsimhub/starsim/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/starsimhub/starsim">
      <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="mailto:info@starsim.org">
      <i class="bi bi-envelope-at-fill" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://starsim.org/">
      <i class="bi bi-globe" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>