<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Calibration – Starsim</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../user_guide/workflows_deploy.html" rel="next">
<link href="../user_guide/workflows_run.html" rel="prev">
<link href="..//assets/favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-234273d1456647dabc34a594ac50e507.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-0348920b7671f696dc9078d39bff215e.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-234273d1456647dabc34a594ac50e507.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-6b5ea9e9a4b01830bd6d14ec679728af.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-5b3fce9591f609771f3fc6325a03de21.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../site_libs/bootstrap/bootstrap-6b5ea9e9a4b01830bd6d14ec679728af.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-SVDSQH04EM"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-SVDSQH04EM', { 'anonymize_ip': true});
</script>


<link rel="stylesheet" href="../assets/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../assets/starsim-logo.png" alt="" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../whatsnew.html"> 
<span class="menu-text">What’s new</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../tutorials.html"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../user_guide.html"> 
<span class="menu-text">User guide</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../conduct.html"> 
<span class="menu-text">Code of conduct</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../contributing.html"> 
<span class="menu-text">Contributing</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../api/index.html"> 
<span class="menu-text">API reference</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://github.com/starsimhub/starsim" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
    <a href="mailto:info@starsim.org" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-envelope-at-fill"></i></a>
    <a href="https://starsim-idm.slack.com" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-slack"></i></a>
    <a href="https://starsim.org" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-globe"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><strong>User guide</strong></li><li class="breadcrumb-item"><a href="../user_guide/workflows_run.html">Workflows</a></li><li class="breadcrumb-item"><a href="../user_guide/workflows_calibration.html">Calibration</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Home</strong></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../whatsnew.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>What’s new</strong></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../api/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>API reference</strong></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>Tutorials</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/t1_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">T1 - Getting started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/t2_model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">T2 - Building your model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/t3_demographics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">T3 - Demographics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/t4_diseases.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">T4 - Diseases</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/t5_networks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">T5 - Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/t6_interventions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">T6 - Interventions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/solutions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Solutions</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>User guide</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Introduction</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../user_guide/intro_starsim.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">What is Starsim?</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../user_guide/intro_spokes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Starsim “spokes”</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Basic concepts</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../user_guide/basics_model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Model structure</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../user_guide/basics_sim.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The Sim object</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../user_guide/basics_people.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">People, States, and Arrays</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../user_guide/basics_parameters.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Parameters</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Modules</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../user_guide/modules_diseases.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Diseases</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../user_guide/modules_networks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../user_guide/modules_demographics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Demographics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../user_guide/modules_interventions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interventions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../user_guide/modules_analyzers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Analyzers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../user_guide/modules_connectors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Connectors</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Workflows</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../user_guide/workflows_run.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multiple runs</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../user_guide/workflows_calibration.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Calibration</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../user_guide/workflows_deploy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Deployment</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../user_guide/workflows_samples.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Samples</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Advanced topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../user_guide/advanced_time.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Time</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../user_guide/advanced_indexing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Array indexing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../user_guide/advanced_distributions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../user_guide/advanced_random.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Random numbers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../user_guide/advanced_profiling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Profiling and debugging</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../user_guide/advanced_nonstandard.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Nonstandard usage</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../conduct.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Code of conduct</strong></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contributing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Contributing</strong></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
        
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><strong>User guide</strong></li><li class="breadcrumb-item"><a href="../user_guide/workflows_run.html">Workflows</a></li><li class="breadcrumb-item"><a href="../user_guide/workflows_calibration.html">Calibration</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Calibration</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Disease models typically require contextualization to a relevant setting of interest prior to addressing “what-if” scenario questions. The process of tuning model input parameters so that model outputs match observed data is known as calibration. There are many approaches to model calibration, ranging from manual tuning to fully Bayesian methods.</p>
<p>For many applications, we have found that an optimization-based approach is sufficient. Such methods avoid the tedious process of manual tuning and are less computationally expensive than fully Bayesian methods. One such optimization-based approach is the <a href="https://optuna.org">Optuna</a> library, which is a Bayesian hyperparameter optimization framework. Optuna is designed for tuning hyperparameters of machine learning models, but it can also be used to calibrate disease models.</p>
<p>Calibration libraries often treat the disease model as a black box, where the input parameters are the “hyperparameters” to be tuned. The calibration process is often iterative and requires a combination of expert knowledge and computational tools. The optimization algorithm iteratively chooses new parameter values to evaluate, and the model is run with these values to generate outputs. The outputs are compared to observed data, and a loss function is calculated to quantify the difference between the model outputs and the observed data. The optimization algorithm then uses this loss function to update its search strategy and choose new parameter values to evaluate. This process continues until the algorithm converges to a set of parameter values that minimize the loss function.</p>
<p>While many optimization algorithms are available, Starsim has a built-in interface to the Optuna library, which we will demonstrate in this guide. We will use a simple Susceptible-Infected-Recovered (SIR) model as an example. We will tune three input parameters, the infectivity parameter, <code>beta</code>, the initial prevalence parameter, <code>init_prev</code>, and the Poisson-distributed degree distribution parameter, <code>n_contacts</code>. We will calibrate the model using a beta-binomial likelihood function so as to match prevalence at three distinct time points.</p>
<p>We begin with a few imports and default settings:</p>
<div id="cell-4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">##%% Imports and settings</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sciris <span class="im">as</span> sc</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> starsim <span class="im">as</span> ss</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.dates <span class="im">as</span> mdates</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>n_agents <span class="op">=</span> <span class="fl">2e3</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>debug <span class="op">=</span> <span class="va">False</span> <span class="co"># If true, will run in serial</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The calibration class will require a base <code>Sim</code> object. This <code>sim</code> will later be modified according to parameters selected by the optimization engine. The following function creates the base <code>Sim</code> object.</p>
<div id="cell-6" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_sim():</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    sir <span class="op">=</span> ss.SIR(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>        beta <span class="op">=</span> ss.peryear(<span class="fl">0.075</span>),</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>        init_prev <span class="op">=</span> ss.bernoulli(<span class="fl">0.02</span>),</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    random <span class="op">=</span> ss.RandomNet(n_contacts<span class="op">=</span>ss.poisson(<span class="dv">4</span>))</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    sim <span class="op">=</span> ss.Sim(</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>        n_agents <span class="op">=</span> n_agents,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>        start <span class="op">=</span> ss.date(<span class="st">'2020-01-01'</span>),</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>        stop <span class="op">=</span> ss.date(<span class="st">'2020-02-12'</span>),</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>        dt <span class="op">=</span> ss.days(<span class="dv">1</span>),</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>        diseases <span class="op">=</span> sir,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>        networks <span class="op">=</span> random,</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>        verbose <span class="op">=</span> <span class="dv">0</span>,</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sim</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now let’s define the calibration parameters. These are the inputs that Optuna will be able to modify. Here, we define three such parameters, <code>beta</code>, <code>init_prev</code>, and <code>n_contacts</code>.</p>
<p>Each parameter entry should have range defined by <code>low</code> and <code>high</code> as well as a <code>guess</code> values. The <code>guess</code> value is not used by Optuna, rather only for a check after calibration completes to see if the new parameters are better than the <code>guess</code> values.</p>
<p>You’ll notice there are a few other parameters that can be specified. For example, the data type of the parameter appears in <code>suggest_type</code>. Possible values are listed in the Optuna documentation, and include <a href="https://optuna.readthedocs.io/en/stable/reference/generated/optuna.trial.Trial.html#optuna.trial.Trial.suggest_float">suggest_float</a> for float values and <a href="https://optuna.readthedocs.io/en/stable/reference/generated/optuna.trial.Trial.html#optuna.trial.Trial.suggest_int">suggest_int</a> for integer types.</p>
<p>To make things easier for the search algorithm, it’s helpful to indicate how outputs are expected to change with inputs. For example, increasing <code>beta</code> from 0.01 to 0.02 should double disease transmission, but increasing from 0.11 to 0.12 will have a small effect. Thus, we indicate that this parameter should be calibrated with <code>log=True</code>.</p>
<div id="cell-8" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the calibration parameters</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>calib_pars <span class="op">=</span> <span class="bu">dict</span>(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    beta <span class="op">=</span> <span class="bu">dict</span>(low<span class="op">=</span><span class="fl">0.01</span>, high<span class="op">=</span><span class="fl">0.30</span>, guess<span class="op">=</span><span class="fl">0.15</span>, suggest_type<span class="op">=</span><span class="st">'suggest_float'</span>, log<span class="op">=</span><span class="va">True</span>), <span class="co"># Note the log scale</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    init_prev <span class="op">=</span> <span class="bu">dict</span>(low<span class="op">=</span><span class="fl">0.01</span>, high<span class="op">=</span><span class="fl">0.05</span>, guess<span class="op">=</span><span class="fl">0.15</span>), <span class="co"># Default type is suggest_float, no need to re-specify</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    n_contacts <span class="op">=</span> <span class="bu">dict</span>(low<span class="op">=</span><span class="dv">2</span>, high<span class="op">=</span><span class="dv">10</span>, guess<span class="op">=</span><span class="dv">3</span>, suggest_type<span class="op">=</span><span class="st">'suggest_int'</span>), <span class="co"># Suggest int just for this demo</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The optimization engine iteratively chooses input parameters to simulate. Those parameters are passed into the following <code>build_sim</code> function as a dictionary of <code>calib_pars</code> along with the base <code>sim</code> and any other key word arguments. The <code>calib_pars</code> will be as above, but importantly will have an additional key named <code>value</code> containing the value selected by Optuna.</p>
<p>When modifying a <code>sim</code>, it is important to realize that the simulation has not been initialized yet. Nonetheless, the configuration is available for modification at <code>sim.pars</code>, as demonstrated in the function below for the SIR example.</p>
<div id="cell-10" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_sim(sim, calib_pars, n_reps<span class="op">=</span><span class="dv">1</span>, <span class="op">**</span>kwargs):</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Modify the base simulation by applying calib_pars. The result can be a</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">    single simulation or multiple simulations if n_reps&gt;1. Note that here we are</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">    simply building the simulation by modifying the base sim. Running the sims</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">    and extracting results will be done by the calibration function.</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    sir <span class="op">=</span> sim.pars.diseases <span class="co"># There is only one disease in this simulation and it is a SIR</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    net <span class="op">=</span> sim.pars.networks <span class="co"># There is only one network in this simulation and it is a RandomNet</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> k, pars <span class="kw">in</span> calib_pars.items(): <span class="co"># Loop over the calibration parameters</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> k <span class="op">==</span> <span class="st">'rand_seed'</span>:</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>            sim.pars.rand_seed <span class="op">=</span> v</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Each item in calib_pars is a dictionary with keys like 'low', 'high',</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'guess', 'suggest_type', and importantly 'value'. The 'value' key is</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># the one we want to use as that's the one selected by the algorithm</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>        v <span class="op">=</span> pars[<span class="st">'value'</span>]</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> k <span class="op">==</span> <span class="st">'beta'</span>:</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>            sir.pars.beta <span class="op">=</span> ss.peryear(v)</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> k <span class="op">==</span> <span class="st">'init_prev'</span>:</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>            sir.pars.init_prev <span class="op">=</span> ss.bernoulli(v)</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> k <span class="op">==</span> <span class="st">'n_contacts'</span>:</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>            net.pars.n_contacts <span class="op">=</span> ss.poisson(v)</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">NotImplementedError</span>(<span class="ss">f'Parameter </span><span class="sc">{</span>k<span class="sc">}</span><span class="ss"> not recognized'</span>)</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If just one simulation per parameter set, return the single simulation</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> n_reps <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> sim</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># But if you'd like to run multiple simulations with the same parameters, we return a MultiSim instead</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note that each simulation will have a different random seed, you can set specific seeds if you like</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Also note that parallel=False and debug=True are important to avoid issues with parallelism in the calibration</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Advanced: If running multiple reps, you can choose if/how they are combined using the "combine_reps" argument to each CalibComponent, introduced below.</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>    ms <span class="op">=</span> ss.MultiSim(sim, iterpars<span class="op">=</span><span class="bu">dict</span>(rand_seed<span class="op">=</span>np.random.randint(<span class="dv">0</span>, <span class="fl">1e6</span>, n_reps)), initialize<span class="op">=</span><span class="va">True</span>, debug<span class="op">=</span><span class="va">True</span>, parallel<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ms</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The Starsim framework has been integrated with the Optuna hyperparameter optimization algorithm to facilitate calibration through the <code>Calibration</code> class. Recall that an optimization-based approach to calibration minimizes a function of the input parameters. This function is key to achieving an acceptable calibration.</p>
<p>There are two ways to describe the goodness-of-fit function for the <code>Calibration</code>. The first method is to directly provide a function that the algorithm will call. The <code>eval_fn</code> will be passed each completed <code>sim</code> after running, and is expected to return a float representing the <strong>mismatch (lower is better as the optimization algorithm is configured to minimize)</strong>. Data can be passed into the <code>eval_fn</code> via <code>eval_kwargs</code>.</p>
<p>As an alternative to directly specifying the evaluation function, you can use <code>CalibComponent</code>s. Each component includes real data, for example from a survey, that is compared against simulation data from the model. Several components can be used at the same time, for example one for disease prevalence and another for treatment coverage. Each component computes a likelihood of the data given the input parameters, as assessed via simulation. Components are combined assuming independence.</p>
<p>The base class for a component is called <code>CalibComponent</code>, which you can use to define your own likelihood. However, we have provided components for several key likelihood functions including <code>BetaBinomial</code>, <code>Binomial</code>, <code>DirichletMultinomial</code>, <code>GammaPoisson</code>, and <code>Normal</code>. The <code>Normal</code> component is most like a traditional squared error. Each component takes in a <code>name</code> and a <code>weight</code>, which is used when combining log likelihoods.</p>
<p>Importantly, each component takes in the calibration target, the real data that was observed, in an argument called <code>expected</code>. This argument should be a Pandas Dataframe with one row per time point and columns that will depend on the specific component type. For example, the <code>Binomial</code> component requires columns of <code>n</code> (trials) and <code>x</code> (successes).</p>
<p>The components also handle extracting data from each simulation using the <code>extract_fn</code> argument. The value of this argument should be a function that takes in a simulation and returns a Pandas DataFrame. The specifics of the columns will depend a bit on the type of component (e.g.&nbsp;<code>BetaBinomial</code> is different from <code>Normal</code>), but often looks like a simulated version of <code>expected</code>. We will see examples below.</p>
<p>We’ll also see how to use the <code>conform</code> argument, the purpose of which is to temporally align the simulation output to the real data. This argument works along with the <code>extract_fn</code> to produce the final simulation outputs that are used in the likelihood function. The conformer is a function that takes in the <code>expected</code> data you provided and the <code>actual</code> simulation result the comes out of the <code>extract_fn</code>. The conformers we have built in are as follows:</p>
<ul>
<li><code>step_containing</code>: Conform by simply choosing the simulated timestep that contains the time indicated in the real data (<code>expected</code>)</li>
<li><code>prevalent</code>: Interpolate the simulated timepoints to estimate the values that would have occurred at each real timepoint</li>
<li><code>incident</code>: While the two methods above capture the state of the model at a particular point in time (stocks), this component allows you to capture the behavior of the model over time (flows). Instead of just giving one time value, <code>t</code>, you’ll provide a second time value as well called <code>t1</code>. This conformer will add up events occurring between the two time points.</li>
</ul>
<p>Let’s make a Binomial component, as might be used to calibrate disease prevalence.</p>
<div id="cell-13" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>prevalence <span class="op">=</span> ss.Normal(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    name <span class="op">=</span> <span class="st">'Disease prevalence'</span>,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    conform <span class="op">=</span> <span class="st">'prevalent'</span>,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    expected <span class="op">=</span> pd.DataFrame({</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">'x'</span>: [<span class="fl">0.13</span>, <span class="fl">0.16</span>, <span class="fl">0.06</span>],    <span class="co"># Prevalence of infection</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    }, index<span class="op">=</span>pd.Index([ss.date(d) <span class="cf">for</span> d <span class="kw">in</span> [<span class="st">'2020-01-12'</span>, <span class="st">'2020-01-25'</span>, <span class="st">'2020-02-02'</span>]], name<span class="op">=</span><span class="st">'t'</span>)), <span class="co"># On these dates</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    extract_fn <span class="op">=</span> <span class="kw">lambda</span> sim: pd.DataFrame({</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'x'</span>: sim.results.sir.prevalence,</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    }, index<span class="op">=</span>pd.Index(sim.results.timevec, name<span class="op">=</span><span class="st">'t'</span>)),</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># You can specify the variance as well, but it's optional (max likelihood estimates will be used if not provided)</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># This could be a single float or an array with the same shape as the expected values</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    sigma2 <span class="op">=</span> <span class="fl">0.05</span>, <span class="co"># e.g. (num_replicates/sigma2_model + 1/sigma2_data)^-1</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">#sigma2 = np.array([0.05, 0.25, 0.01])</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, we can bring all the pieces together. We make a single base simulation and create an instance of a Starsim Calibration object. This object requires a few arguments, like the <code>calib_pars</code> and <code>sim</code>. We also pass in the function that modifies the base <code>sim</code>, here our <code>build_sim</code> function. No additional <code>build_kw</code> are required in this example.</p>
<p>We also pass in a list of <code>components</code>. Instead of using this “component-based” system, a user could simply provide an <code>eval_fn</code>, which takes in a completed sim an any <code>eval_kwargs</code> and returns a “mismatch” score to be minimized.</p>
<p>We can also specify the total number of trials to run, the number of parallel works, and a few other parameters.</p>
<div id="cell-15" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>sc.heading(<span class="st">'Beginning calibration'</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the sim and data</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>sim <span class="op">=</span> make_sim()</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the calibration</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>calib <span class="op">=</span> ss.Calibration(</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    calib_pars <span class="op">=</span> calib_pars,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    sim <span class="op">=</span> sim,</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    build_fn <span class="op">=</span> build_sim,</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    build_kw <span class="op">=</span> <span class="bu">dict</span>(n_reps<span class="op">=</span><span class="dv">3</span>), <span class="co"># Run 3 replicates for each parameter set</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    reseed <span class="op">=</span> <span class="va">True</span>, <span class="co"># If true, a different random seed will be provided to each configuration</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    components <span class="op">=</span> [prevalence],</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    total_trials <span class="op">=</span> <span class="dv">100</span>,</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    n_workers <span class="op">=</span> <span class="va">None</span>, <span class="co"># None indicates to use all available CPUs</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    die <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    debug <span class="op">=</span> debug, <span class="co"># Run in serial if True</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform the calibration</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>sc.printcyan(<span class="st">'</span><span class="ch">\n</span><span class="st">Peforming calibration...'</span>)</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>calib.calibrate()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre><span class="ansi-cyan-fg">



—————————————————————

Beginning calibration

—————————————————————

</span>

<span class="ansi-cyan-fg">

Peforming calibration...</span>

Removed existing calibration file starsim_calibration.db

sqlite:///starsim_calibration.db
</pre>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[I 2025-08-04 18:05:41,057] A new study created in RDB with name: starsim_calibration
[I 2025-08-04 18:05:42,755] Trial 1 finished with value: -0.44981093690565604 and parameters: {'beta': 0.07553254901838954, 'init_prev': 0.010623494926858133, 'n_contacts': 10, 'rand_seed': 433446}. Best is trial 1 with value: -0.44981093690565604.
[I 2025-08-04 18:05:42,761] Trial 3 finished with value: -0.449572325794545 and parameters: {'beta': 0.01961207740877714, 'init_prev': 0.01012261691719703, 'n_contacts': 8, 'rand_seed': 180549}. Best is trial 1 with value: -0.44981093690565604.
[I 2025-08-04 18:05:42,778] Trial 4 finished with value: -0.5066014924612117 and parameters: {'beta': 0.058658631402975434, 'init_prev': 0.042534023778888305, 'n_contacts': 3, 'rand_seed': 724195}. Best is trial 4 with value: -0.5066014924612117.
[I 2025-08-04 18:05:42,995] Trial 5 finished with value: -0.47252010357232277 and parameters: {'beta': 0.14532343237046544, 'init_prev': 0.020894275400617297, 'n_contacts': 4, 'rand_seed': 855145}. Best is trial 4 with value: -0.5066014924612117.
[I 2025-08-04 18:05:43,038] Trial 9 finished with value: -0.4788145480167672 and parameters: {'beta': 0.012898853458389823, 'init_prev': 0.02490264521778353, 'n_contacts': 10, 'rand_seed': 18040}. Best is trial 4 with value: -0.5066014924612117.
[I 2025-08-04 18:05:43,186] Trial 15 finished with value: -0.47738454801676716 and parameters: {'beta': 0.012105785028107737, 'init_prev': 0.023531045033863034, 'n_contacts': 8, 'rand_seed': 309556}. Best is trial 4 with value: -0.5066014924612117.
[I 2025-08-04 18:05:43,196] Trial 14 finished with value: -0.5101623257945449 and parameters: {'beta': 0.012920769255954593, 'init_prev': 0.044341142361296534, 'n_contacts': 6, 'rand_seed': 382646}. Best is trial 14 with value: -0.5101623257945449.
[I 2025-08-04 18:05:43,268] Trial 0 finished with value: -0.49035121468343384 and parameters: {'beta': 0.01885821140391564, 'init_prev': 0.03115300759327229, 'n_contacts': 9, 'rand_seed': 255576}. Best is trial 14 with value: -0.5101623257945449.
[I 2025-08-04 18:05:43,306] Trial 17 finished with value: -0.4607020480167672 and parameters: {'beta': 0.021503779057190493, 'init_prev': 0.01593263874981397, 'n_contacts': 10, 'rand_seed': 606508}. Best is trial 14 with value: -0.5101623257945449.
[I 2025-08-04 18:05:43,328] Trial 12 finished with value: -0.4629187146834339 and parameters: {'beta': 0.23149023956723366, 'init_prev': 0.01637406805329071, 'n_contacts': 5, 'rand_seed': 373703}. Best is trial 14 with value: -0.5101623257945449.
[I 2025-08-04 18:05:43,365] Trial 6 finished with value: -0.5109581591278782 and parameters: {'beta': 0.022787990007422064, 'init_prev': 0.04461016314827858, 'n_contacts': 7, 'rand_seed': 820817}. Best is trial 6 with value: -0.5109581591278782.
[I 2025-08-04 18:05:43,454] Trial 10 finished with value: -0.4937517702389894 and parameters: {'beta': 0.05608624538868571, 'init_prev': 0.03372998002387857, 'n_contacts': 3, 'rand_seed': 731006}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:43,456] Trial 7 finished with value: -0.4592303813501005 and parameters: {'beta': 0.27014934555622566, 'init_prev': 0.014551256749120865, 'n_contacts': 3, 'rand_seed': 529264}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:43,462] Trial 2 finished with value: -0.46576454801676725 and parameters: {'beta': 0.11740703374041636, 'init_prev': 0.01801381497891888, 'n_contacts': 6, 'rand_seed': 791255}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:43,477] Trial 8 finished with value: -0.5169209369056561 and parameters: {'beta': 0.01816702263490502, 'init_prev': 0.049784007865639836, 'n_contacts': 4, 'rand_seed': 575437}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:43,483] Trial 16 finished with value: -0.4929392702389894 and parameters: {'beta': 0.019154157712861667, 'init_prev': 0.03335062254891218, 'n_contacts': 3, 'rand_seed': 344204}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:43,534] Trial 11 finished with value: -0.5136698257945449 and parameters: {'beta': 0.026076247410548755, 'init_prev': 0.04660187584597949, 'n_contacts': 6, 'rand_seed': 522922}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:43,703] Trial 13 finished with value: -0.46390399246121167 and parameters: {'beta': 0.28416832894326555, 'init_prev': 0.01673353634506193, 'n_contacts': 5, 'rand_seed': 694512}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:43,704] Trial 22 finished with value: -0.4475501035723227 and parameters: {'beta': 0.08978885373494497, 'init_prev': 0.01086742309237589, 'n_contacts': 6, 'rand_seed': 799893}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:43,704] Trial 20 finished with value: -0.5051389924612116 and parameters: {'beta': 0.03773333295301447, 'init_prev': 0.044429039170489695, 'n_contacts': 10, 'rand_seed': 687540}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:43,754] Trial 18 finished with value: -0.4581117702389894 and parameters: {'beta': 0.08383449618356444, 'init_prev': 0.013869845871404878, 'n_contacts': 8, 'rand_seed': 338634}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:43,770] Trial 23 finished with value: -0.49230538135010055 and parameters: {'beta': 0.08961280509108403, 'init_prev': 0.033753042102942374, 'n_contacts': 9, 'rand_seed': 829446}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:43,833] Trial 19 finished with value: -0.4949959369056562 and parameters: {'beta': 0.1359578871775199, 'init_prev': 0.03208320467025896, 'n_contacts': 8, 'rand_seed': 167916}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:43,901] Trial 25 finished with value: -0.46740593690565607 and parameters: {'beta': 0.106121274847802, 'init_prev': 0.020949380166629415, 'n_contacts': 6, 'rand_seed': 965652}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:44,027] Trial 27 finished with value: -0.5131653813501005 and parameters: {'beta': 0.0342878140580294, 'init_prev': 0.049850734265389086, 'n_contacts': 6, 'rand_seed': 995857}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:44,059] Trial 26 finished with value: -0.45178593690565605 and parameters: {'beta': 0.01279053585550109, 'init_prev': 0.013592654796255635, 'n_contacts': 6, 'rand_seed': 717333}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:44,106] Trial 24 finished with value: -0.47987399246121165 and parameters: {'beta': 0.06278699924289378, 'init_prev': 0.028563181735690592, 'n_contacts': 10, 'rand_seed': 191570}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:44,148] Trial 21 finished with value: -0.45886343690565606 and parameters: {'beta': 0.06825369231990483, 'init_prev': 0.01769583168076677, 'n_contacts': 4, 'rand_seed': 59961}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:44,154] Trial 28 finished with value: -0.5118014924612116 and parameters: {'beta': 0.03466177558077176, 'init_prev': 0.04920693843565434, 'n_contacts': 7, 'rand_seed': 941636}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:44,248] Trial 32 finished with value: -0.5101656591278784 and parameters: {'beta': 0.03327097169309982, 'init_prev': 0.04804772639738838, 'n_contacts': 5, 'rand_seed': 571871}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:44,288] Trial 33 finished with value: -0.5125323257945449 and parameters: {'beta': 0.030235748071597665, 'init_prev': 0.049400211707656246, 'n_contacts': 5, 'rand_seed': 992949}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:44,347] Trial 29 finished with value: -0.513472325794545 and parameters: {'beta': 0.033229074556924545, 'init_prev': 0.04980244299817063, 'n_contacts': 5, 'rand_seed': 950607}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:44,370] Trial 30 finished with value: -0.513472325794545 and parameters: {'beta': 0.033186258070507534, 'init_prev': 0.049726091250762536, 'n_contacts': 5, 'rand_seed': 961535}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:44,391] Trial 34 finished with value: -0.5125323257945449 and parameters: {'beta': 0.034043886999593834, 'init_prev': 0.049546386064057875, 'n_contacts': 5, 'rand_seed': 996838}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:44,394] Trial 31 finished with value: -0.5125323257945449 and parameters: {'beta': 0.03453233058233213, 'init_prev': 0.04931432727235206, 'n_contacts': 5, 'rand_seed': 980271}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:44,668] Trial 36 finished with value: -0.516113436905656 and parameters: {'beta': 0.033538234233236604, 'init_prev': 0.04931149246991297, 'n_contacts': 7, 'rand_seed': 582183}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:44,669] Trial 35 finished with value: -0.513472325794545 and parameters: {'beta': 0.03614871132902712, 'init_prev': 0.049849525015371786, 'n_contacts': 5, 'rand_seed': 987517}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:44,671] Trial 38 finished with value: -0.5120312146834338 and parameters: {'beta': 0.0321235646269469, 'init_prev': 0.04948538248904738, 'n_contacts': 7, 'rand_seed': 917373}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:44,854] Trial 37 finished with value: -0.5167942702389895 and parameters: {'beta': 0.03292793181636787, 'init_prev': 0.04983891178816257, 'n_contacts': 7, 'rand_seed': 951373}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:44,875] Trial 40 finished with value: -0.5162356591278783 and parameters: {'beta': 0.03380411681570785, 'init_prev': 0.0496489170897043, 'n_contacts': 7, 'rand_seed': 929719}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:44,932] Trial 42 finished with value: -0.5153814924612116 and parameters: {'beta': 0.03665879944411343, 'init_prev': 0.04940364624705149, 'n_contacts': 5, 'rand_seed': 527347}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:44,967] Trial 45 finished with value: -0.5143459369056561 and parameters: {'beta': 0.03212594446036035, 'init_prev': 0.04881209512841181, 'n_contacts': 2, 'rand_seed': 998316}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:45,005] Trial 44 finished with value: -0.513472325794545 and parameters: {'beta': 0.036642963518545214, 'init_prev': 0.04987392954477107, 'n_contacts': 5, 'rand_seed': 467665}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:45,023] Trial 46 finished with value: -0.5020770480167671 and parameters: {'beta': 0.028668561674763372, 'init_prev': 0.03986318305366871, 'n_contacts': 4, 'rand_seed': 469789}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:45,023] Trial 43 finished with value: -0.5160639924612116 and parameters: {'beta': 0.03840932892187582, 'init_prev': 0.04984452300795703, 'n_contacts': 5, 'rand_seed': 504479}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:45,027] Trial 48 finished with value: -0.5018384369056561 and parameters: {'beta': 0.028080648426744865, 'init_prev': 0.03955932069792161, 'n_contacts': 4, 'rand_seed': 459295}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:45,042] Trial 39 finished with value: -0.5120312146834338 and parameters: {'beta': 0.03419298000717285, 'init_prev': 0.04947451542881073, 'n_contacts': 7, 'rand_seed': 993686}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:45,276] Trial 49 finished with value: -0.5015134369056562 and parameters: {'beta': 0.043203093509745445, 'init_prev': 0.03895746336340112, 'n_contacts': 2, 'rand_seed': 890512}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:45,278] Trial 47 finished with value: -0.49824510357232277 and parameters: {'beta': 0.027113723043322907, 'init_prev': 0.03696169859693052, 'n_contacts': 4, 'rand_seed': 466077}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:45,319] Trial 41 finished with value: -0.5114142702389894 and parameters: {'beta': 0.031330975922492926, 'init_prev': 0.049404793303803096, 'n_contacts': 2, 'rand_seed': 548641}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:45,360] Trial 54 finished with value: -0.5015134369056562 and parameters: {'beta': 0.045453834397924046, 'init_prev': 0.0391854377591971, 'n_contacts': 2, 'rand_seed': 456366}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:45,360] Trial 53 finished with value: -0.5024945480167672 and parameters: {'beta': 0.044066936175276364, 'init_prev': 0.03982280801451209, 'n_contacts': 2, 'rand_seed': 467526}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:45,374] Trial 50 finished with value: -0.5022564924612117 and parameters: {'beta': 0.04765352253906807, 'init_prev': 0.039636538106174055, 'n_contacts': 2, 'rand_seed': 436058}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:45,387] Trial 52 finished with value: -0.5012570480167672 and parameters: {'beta': 0.04664323062776957, 'init_prev': 0.039284915576735344, 'n_contacts': 4, 'rand_seed': 464197}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:45,476] Trial 56 finished with value: -0.4965392702389894 and parameters: {'beta': 0.015922765970832812, 'init_prev': 0.039567390025823726, 'n_contacts': 2, 'rand_seed': 453104}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:45,480] Trial 51 finished with value: -0.5030217702389894 and parameters: {'beta': 0.04698004870233414, 'init_prev': 0.040586701956071634, 'n_contacts': 2, 'rand_seed': 898004}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:45,640] Trial 58 finished with value: -0.497064825794545 and parameters: {'beta': 0.015067936196999, 'init_prev': 0.03969364504392992, 'n_contacts': 7, 'rand_seed': 456335}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:45,643] Trial 55 finished with value: -0.5019945480167672 and parameters: {'beta': 0.04525716048006801, 'init_prev': 0.03943902565142538, 'n_contacts': 2, 'rand_seed': 464528}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:45,660] Trial 59 finished with value: -0.4990012146834339 and parameters: {'beta': 0.043148013625057074, 'init_prev': 0.04027217896118974, 'n_contacts': 7, 'rand_seed': 445321}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:45,778] Trial 57 finished with value: -0.5020926035723227 and parameters: {'beta': 0.025367089436645587, 'init_prev': 0.039699038969874124, 'n_contacts': 2, 'rand_seed': 424082}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:45,933] Trial 61 finished with value: -0.5064903813501006 and parameters: {'beta': 0.04651831002333319, 'init_prev': 0.04591100455303464, 'n_contacts': 9, 'rand_seed': 628583}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:45,962] Trial 64 finished with value: -0.506969825794545 and parameters: {'beta': 0.044447515468434125, 'init_prev': 0.04658979040952751, 'n_contacts': 9, 'rand_seed': 630370}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:46,003] Trial 65 finished with value: -0.5107937146834339 and parameters: {'beta': 0.044466699849850175, 'init_prev': 0.04615062544332026, 'n_contacts': 9, 'rand_seed': 895636}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:46,169] Trial 60 finished with value: -0.4997870480167672 and parameters: {'beta': 0.048947418436240175, 'init_prev': 0.040614216416346986, 'n_contacts': 7, 'rand_seed': 883221}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:46,180] Trial 62 finished with value: -0.5067339924612116 and parameters: {'beta': 0.04690989789857649, 'init_prev': 0.046325172191867214, 'n_contacts': 9, 'rand_seed': 881683}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:46,287] Trial 63 finished with value: -0.506969825794545 and parameters: {'beta': 0.04575299194180441, 'init_prev': 0.04646848305505414, 'n_contacts': 9, 'rand_seed': 636272}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:46,294] Trial 68 finished with value: -0.5067070480167671 and parameters: {'beta': 0.023082885597055843, 'init_prev': 0.04648668683213909, 'n_contacts': 7, 'rand_seed': 623896}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:46,294] Trial 71 finished with value: -0.506299825794545 and parameters: {'beta': 0.015658244116536945, 'init_prev': 0.046041845295603304, 'n_contacts': 7, 'rand_seed': 654136}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:46,317] Trial 66 finished with value: -0.5107217702389895 and parameters: {'beta': 0.04806514898752032, 'init_prev': 0.04609895952437706, 'n_contacts': 7, 'rand_seed': 645557}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:46,318] Trial 69 finished with value: -0.5110506591278784 and parameters: {'beta': 0.016863518502375524, 'init_prev': 0.046545288050022456, 'n_contacts': 7, 'rand_seed': 633093}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:46,391] Trial 74 finished with value: -0.506601214683434 and parameters: {'beta': 0.02366099462998718, 'init_prev': 0.04663192885029669, 'n_contacts': 8, 'rand_seed': 621674}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:46,391] Trial 70 finished with value: -0.5067070480167671 and parameters: {'beta': 0.022766641974117954, 'init_prev': 0.046787890512729545, 'n_contacts': 7, 'rand_seed': 610725}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:46,434] Trial 73 finished with value: -0.5063626035723228 and parameters: {'beta': 0.0239302612100303, 'init_prev': 0.04619166532034476, 'n_contacts': 8, 'rand_seed': 638092}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:46,484] Trial 67 finished with value: -0.5067070480167671 and parameters: {'beta': 0.025393730019332917, 'init_prev': 0.04645329368411897, 'n_contacts': 7, 'rand_seed': 636063}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:46,636] Trial 78 finished with value: -0.5063867702389895 and parameters: {'beta': 0.02164691638772139, 'init_prev': 0.04651234952675082, 'n_contacts': 8, 'rand_seed': 633171}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:46,638] Trial 72 finished with value: -0.506601214683434 and parameters: {'beta': 0.02248244365769078, 'init_prev': 0.04674535658315714, 'n_contacts': 8, 'rand_seed': 658007}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:46,706] Trial 75 finished with value: -0.5060367702389894 and parameters: {'beta': 0.025203624338242327, 'init_prev': 0.04636693471598282, 'n_contacts': 8, 'rand_seed': 645448}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:46,727] Trial 77 finished with value: -0.5061178813501006 and parameters: {'beta': 0.023820323224988862, 'init_prev': 0.04595781145863685, 'n_contacts': 8, 'rand_seed': 626485}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:46,909] Trial 79 finished with value: -0.5063626035723228 and parameters: {'beta': 0.022375964113718904, 'init_prev': 0.04628280958689703, 'n_contacts': 8, 'rand_seed': 642470}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:46,952] Trial 80 finished with value: -0.5007878813501005 and parameters: {'beta': 0.020942140102709648, 'init_prev': 0.04259620426399234, 'n_contacts': 3, 'rand_seed': 852863}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:46,962] Trial 84 finished with value: -0.5014887146834339 and parameters: {'beta': 0.05588044198778258, 'init_prev': 0.04311739770433148, 'n_contacts': 3, 'rand_seed': 761349}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:46,967] Trial 82 finished with value: -0.5020314924612116 and parameters: {'beta': 0.021242520502909864, 'init_prev': 0.04325258061097305, 'n_contacts': 3, 'rand_seed': 765047}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:46,974] Trial 76 finished with value: -0.5057892702389895 and parameters: {'beta': 0.02398712260225186, 'init_prev': 0.04632821052105929, 'n_contacts': 8, 'rand_seed': 637704}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:47,036] Trial 87 finished with value: -0.5026953813501005 and parameters: {'beta': 0.020781428859643947, 'init_prev': 0.04378966352203858, 'n_contacts': 6, 'rand_seed': 513210}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:47,086] Trial 81 finished with value: -0.5010492702389895 and parameters: {'beta': 0.010112454583116152, 'init_prev': 0.04347152929106646, 'n_contacts': 3, 'rand_seed': 510157}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:47,110] Trial 83 finished with value: -0.5007878813501005 and parameters: {'beta': 0.016699349683781426, 'init_prev': 0.042620222011509785, 'n_contacts': 3, 'rand_seed': 770322}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:47,275] Trial 85 finished with value: -0.5014887146834339 and parameters: {'beta': 0.05642784796107949, 'init_prev': 0.04320290294931737, 'n_contacts': 3, 'rand_seed': 583691}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:47,329] Trial 91 finished with value: -0.5008356591278784 and parameters: {'beta': 0.01891357185864384, 'init_prev': 0.042877678709097325, 'n_contacts': 6, 'rand_seed': 518215}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:47,330] Trial 93 finished with value: -0.5090831591278784 and parameters: {'beta': 0.02040291185283774, 'init_prev': 0.048130053761924585, 'n_contacts': 6, 'rand_seed': 510950}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:47,333] Trial 92 finished with value: -0.501352325794545 and parameters: {'beta': 0.020766896854564537, 'init_prev': 0.04317639515613413, 'n_contacts': 6, 'rand_seed': 511287}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:47,362] Trial 94 finished with value: -0.5015314924612118 and parameters: {'beta': 0.039978109585131094, 'init_prev': 0.04353543432214712, 'n_contacts': 6, 'rand_seed': 755640}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:47,400] Trial 89 finished with value: -0.5083589924612117 and parameters: {'beta': 0.020164639581070502, 'init_prev': 0.047811570162748826, 'n_contacts': 6, 'rand_seed': 761359}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:47,413] Trial 88 finished with value: -0.5008356591278784 and parameters: {'beta': 0.01854670886902243, 'init_prev': 0.04269767069130883, 'n_contacts': 6, 'rand_seed': 507352}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:47,414] Trial 86 finished with value: -0.5010959369056561 and parameters: {'beta': 0.0188480066723251, 'init_prev': 0.04312260789467864, 'n_contacts': 6, 'rand_seed': 517685}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:47,465] Trial 90 finished with value: -0.5024456591278783 and parameters: {'beta': 0.010132680027743635, 'init_prev': 0.04344516125606053, 'n_contacts': 6, 'rand_seed': 516281}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:47,516] Trial 96 finished with value: -0.5094837146834338 and parameters: {'beta': 0.03996873944813089, 'init_prev': 0.048381504196801525, 'n_contacts': 6, 'rand_seed': 506412}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:47,546] Trial 95 finished with value: -0.5010959369056561 and parameters: {'beta': 0.01061826801251261, 'init_prev': 0.043157659316225394, 'n_contacts': 6, 'rand_seed': 501674}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:47,620] Trial 97 finished with value: -0.5088401035723229 and parameters: {'beta': 0.01810262965285105, 'init_prev': 0.04795272153337613, 'n_contacts': 6, 'rand_seed': 511721}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:47,626] Trial 98 finished with value: -0.5094837146834338 and parameters: {'beta': 0.03981280044715889, 'init_prev': 0.04833163447249708, 'n_contacts': 6, 'rand_seed': 569291}. Best is trial 8 with value: -0.5169209369056561.
[I 2025-08-04 18:05:47,864] Trial 99 finished with value: -0.5094414924612116 and parameters: {'beta': 0.03868351077682247, 'init_prev': 0.048267625410711654, 'n_contacts': 5, 'rand_seed': 953739}. Best is trial 8 with value: -0.5169209369056561.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Making results structure...
Processed 100 trials; 0 failed
Best pars: {'beta': 0.01816702263490502, 'init_prev': 0.049784007865639836, 'n_contacts': 4, 'rand_seed': 575437}
Removed existing calibration file starsim_calibration.db</code></pre>
</div>
</div>
<p>Let’s look at the best parameters that were found. Note that the <code>rand_seed</code> was selected at random, but the other parameters are meaningful.</p>
<div id="cell-17" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>calib.best_pars</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>{'beta': 0.01816702263490502,
 'init_prev': 0.049784007865639836,
 'n_contacts': 4,
 'rand_seed': 575437}</code></pre>
</div>
</div>
<p>Once the calibration is complete, we can compare the <code>guess</code> values to the best values found by calling <code>check_fit</code>.</p>
<div id="cell-19" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Confirm - Note the comparison is here configured over n_reps=15 replicates</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>sc.printcyan(<span class="st">'</span><span class="ch">\n</span><span class="st">Confirming fit...'</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Increase replicates to 15 for more representative results when running check_fit</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>calib.build_kw[<span class="st">'n_reps'</span>] <span class="op">=</span> <span class="dv">15</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>calib.check_fit(do_plot<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre><span class="ansi-cyan-fg">

Confirming fit...</span>

<span class="ansi-cyan-fg">

Checking fit...</span>

Fit with original pars: -0.5454663813501005

Fit with best-fit pars: -0.5167228813501004

✗ Calibration did not improve fit as the objective got worse (-0.5454663813501005 --&gt; -0.5167228813501004), but this sometimes happens stochastically and is not necessarily an error
</pre>
</div>
</div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>False</code></pre>
</div>
</div>
<p>After calling <code>check_fit</code>, we can plot the results. This first plot shows the Normal likelihood distributions from each of the 15 simulations we did in <code>check_fit</code> as the colored lines. The vertical dashed line is located at the real (<code>expected</code>) data. Top row is the “guess” values and the bottom row is the new “best” parameters. We want the vertical dashed line to cross the Gaussians at high points, representing high likelihood.</p>
<div id="cell-21" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>calib.plot()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="workflows_calibration_files/figure-html/cell-10-output-1.png" width="1286" height="569" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Another way to plot the results is via bootstrapping. Here we repeatedly choose 15 from the <code>n_reps=15</code> simulations (with replacement), compute the average (or sum for some components), and repeatedly calculate the mean. We then plot the distribution of means, and hope it lands near the vertical dashed lines representing the real data.</p>
<div id="cell-23" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>calib.plot(bootstrap<span class="op">=</span><span class="va">True</span>)<span class="op">;</span> <span class="co"># Pass bootstrap=True to produce this plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="workflows_calibration_files/figure-html/cell-11-output-1.png" width="1286" height="569" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We can view some plots of the final fitted results. Whereas the two plots above were from the <code>check_fit</code>, running both “guess” and “best” parameters, here we make make new simulations to visualize the results.</p>
<div id="cell-25" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> calib.plot_final()<span class="op">;</span> <span class="co"># Run the model for build_kw['n_reps'] = 15 replicates</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="workflows_calibration_files/figure-html/cell-12-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-26" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>calib</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>&lt;starsim.calibration.Calibration at 0x77eed52ead20&gt;
[&lt;class 'starsim.calibration.Calibration'&gt;, &lt;class 'sciris.sc_printing.prettyobj'&gt;]
————————————————————————————————————————————————————————————————————————
Methods:
  _eval_fit()             make_study()            run_sim()               
  _sample_from_trial()    parse_study()           run_trial()             
  build_fn()              plot()                  run_workers()           
  calibrate()             plot_final()            to_df()                 
  check_fit()             plot_optuna()           to_json()               
  eval_fn()               remove_db()             worker()                
————————————————————————————————————————————————————————————————————————
 after_fits: -0.5167228813501004
 after_msim: MultiSim(n_sims: 15; base: Sim(n=2000;
             2020.01.01—2020.02.12; not ini [...]
before_fits: -0.5454663813501005
before_msim: MultiSim(n_sims: 15; base: Sim(n=2000;
             2020.01.01—2020.02.12; not ini [...]
  best_pars: {'beta': 0.01816702263490502, 'init_prev':
             0.049784007865639836, 'n_c [...]
   build_fn: &lt;function build_sim at 0x77eed5010860&gt;
   build_kw: {'n_reps': 15}
 calib_pars: {'beta': {'low': 0.01, 'high': 0.3, 'guess': 0.15,
             'suggest_type': 's [...]
 calibrated: True
 components: [Calibration component with name Disease prevalence]
         df:     index  mismatch      beta  init_prev  n_contacts
             rand_seed
             8     [...]
        die: True
    elapsed: 7.303730487823486
    eval_fn: &lt;bound method Calibration._eval_fit of
             &lt;starsim.calibration.Calibrati [...]
    eval_kw: {}
      label: None
   prune_fn: None
     reseed: True
   run_args: #0. 'n_trials':    5
             #1. 'n_workers':   20
             #2. 'debug':       False
             # [...]
        sim: Sim(n=2000; 2020.01.01—2020.02.12; not initialized)
      study: &lt;optuna.study.study.Study object at 0x77eed3d0b770&gt;
 study_data: #0. 'index':      [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11,
             12, 13, 14,  [...]
    verbose: True
————————————————————————————————————————————————————————————————————————</code></pre>
</div>
</div>
<p>Optuna has lots of diagnostic plots that we can explore. Possible plots include:</p>
<ul>
<li>plot_contour</li>
<li>plot_edf</li>
<li>plot_hypervolume_history</li>
<li>plot_intermediate_values</li>
<li>plot_optimization_history</li>
<li>plot_parallel_coordinate</li>
<li>plot_param_importances</li>
<li>plot_pareto_front</li>
<li>plot_rank</li>
<li>plot_slice</li>
<li>plot_terminator_improvement</li>
<li>plot_timeline</li>
</ul>
<p>Here are some examples:</p>
<div id="cell-28" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>calib.plot_optuna(<span class="st">'plot_optimization_history'</span>)<span class="op">;</span> <span class="co"># Plot the optimization history</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/home/cliffk/idm/starsim/starsim/calibration.py:433: ExperimentalWarning: plot_optimization_history is experimental (supported from v2.2.0). The interface can change in the future.
  fig = getattr(vis, method)(self.study)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="workflows_calibration_files/figure-html/cell-14-output-2.png" width="795" height="454" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-29" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>calib.plot_optuna(<span class="st">'plot_contour'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/home/cliffk/idm/starsim/starsim/calibration.py:433: ExperimentalWarning: plot_contour is experimental (supported from v2.2.0). The interface can change in the future.
  fig = getattr(vis, method)(self.study)
[W 2025-08-04 18:05:58,665] Output figures of this Matplotlib-based `plot_contour` function would be different from those of the Plotly-based `plot_contour`.</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="workflows_calibration_files/figure-html/cell-15-output-2.png" width="621" height="481" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-30" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>calib.plot_optuna(<span class="st">'plot_param_importances'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Could not run plot_param_importances: Tried to import 'sklearn' but failed. Please make sure that the package is installed correctly to use this feature. Actual error: No module named 'sklearn'.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/home/cliffk/idm/starsim/starsim/calibration.py:433: ExperimentalWarning: plot_param_importances is experimental (supported from v2.2.0). The interface can change in the future.
  fig = getattr(vis, method)(self.study)</code></pre>
</div>
</div>
<p>If you choose not to use components, you can always create your own mismatch function, as in the following example:</p>
<div id="cell-32" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>my_data <span class="op">=</span> (ss.date(<span class="st">'2020-01-12'</span>), <span class="fl">0.13</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="bu">eval</span>(sim, expected):</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute the squared error at one point in time.</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># expected will contain my_data in this example due to eval_kw</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    date, p <span class="op">=</span> expected</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(sim, ss.MultiSim):</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>        sim <span class="op">=</span> ss.MultiSim(sims<span class="op">=</span>[sim])</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    ret <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> s <span class="kw">in</span> sim.sims:</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>        ind <span class="op">=</span> np.searchsorted(s.results.timevec, date, side<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>        prev <span class="op">=</span> s.results.sir.prevalence[ind]</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>        ret <span class="op">+=</span> (prev <span class="op">-</span> p)<span class="op">**</span><span class="dv">2</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ret</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the calibration parameters</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>calib_pars <span class="op">=</span> <span class="bu">dict</span>(</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>    beta <span class="op">=</span> <span class="bu">dict</span>(low<span class="op">=</span><span class="fl">0.01</span>, high<span class="op">=</span><span class="fl">0.30</span>, guess<span class="op">=</span><span class="fl">0.15</span>, suggest_type<span class="op">=</span><span class="st">'suggest_float'</span>, log<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the sim and data</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>sim <span class="op">=</span> make_sim()</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the calibration</span></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>calib <span class="op">=</span> ss.Calibration(</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>    calib_pars <span class="op">=</span> calib_pars,</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>    sim <span class="op">=</span> sim,</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>    build_fn <span class="op">=</span> build_sim,</span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>    build_kw <span class="op">=</span> <span class="bu">dict</span>(n_reps<span class="op">=</span><span class="dv">2</span>), <span class="co"># Two reps per point</span></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>    reseed <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>    eval_fn <span class="op">=</span> <span class="bu">eval</span>, <span class="co"># Will call my_function(msim, eval_kwargs)</span></span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>    eval_kw <span class="op">=</span> <span class="bu">dict</span>(expected<span class="op">=</span>my_data), <span class="co"># Will call eval(sim, **eval_kw)</span></span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>    total_trials <span class="op">=</span> <span class="dv">20</span>,</span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>    n_workers <span class="op">=</span> <span class="va">None</span>, <span class="co"># None indicates to use all available CPUs</span></span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>    die <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>    debug <span class="op">=</span> debug,</span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform the calibration</span></span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a>sc.printcyan(<span class="st">'</span><span class="ch">\n</span><span class="st">Peforming calibration...'</span>)</span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a>calib.calibrate()</span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Check</span></span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a>calib.check_fit()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>[I 2025-08-04 18:06:00,518] A new study created in RDB with name: starsim_calibration</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre><span class="ansi-cyan-fg">

Peforming calibration...</span>

Removed existing calibration file starsim_calibration.db

sqlite:///starsim_calibration.db
</pre>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[I 2025-08-04 18:06:01,051] Trial 1 finished with value: 0.024646500000000002 and parameters: {'beta': 0.10812104554755586, 'rand_seed': 457085}. Best is trial 1 with value: 0.024646500000000002.
[I 2025-08-04 18:06:01,165] Trial 6 finished with value: 0.024646500000000002 and parameters: {'beta': 0.04272537526112574, 'rand_seed': 296821}. Best is trial 1 with value: 0.024646500000000002.
[I 2025-08-04 18:06:01,173] Trial 5 finished with value: 0.024646500000000002 and parameters: {'beta': 0.10369447330355346, 'rand_seed': 365326}. Best is trial 1 with value: 0.024646500000000002.
[I 2025-08-04 18:06:01,208] Trial 4 finished with value: 0.024646500000000002 and parameters: {'beta': 0.019254887946383973, 'rand_seed': 385376}. Best is trial 1 with value: 0.024646500000000002.
[I 2025-08-04 18:06:01,214] Trial 2 finished with value: 0.024646500000000002 and parameters: {'beta': 0.01350572406574447, 'rand_seed': 314951}. Best is trial 1 with value: 0.024646500000000002.
[I 2025-08-04 18:06:01,297] Trial 3 finished with value: 0.024646500000000002 and parameters: {'beta': 0.06764637766228687, 'rand_seed': 401985}. Best is trial 1 with value: 0.024646500000000002.
[I 2025-08-04 18:06:01,402] Trial 11 finished with value: 0.02431325 and parameters: {'beta': 0.2528275433685965, 'rand_seed': 687263}. Best is trial 11 with value: 0.02431325.
[I 2025-08-04 18:06:01,411] Trial 16 finished with value: 0.024646500000000002 and parameters: {'beta': 0.05351495410795384, 'rand_seed': 921098}. Best is trial 11 with value: 0.02431325.
[I 2025-08-04 18:06:01,411] Trial 18 finished with value: 0.02431325 and parameters: {'beta': 0.21032836388449866, 'rand_seed': 660102}. Best is trial 11 with value: 0.02431325.
[I 2025-08-04 18:06:01,416] Trial 10 finished with value: 0.024646500000000002 and parameters: {'beta': 0.014400108380040829, 'rand_seed': 401159}. Best is trial 11 with value: 0.02431325.
[I 2025-08-04 18:06:01,425] Trial 19 finished with value: 0.024646500000000002 and parameters: {'beta': 0.09603932462994463, 'rand_seed': 135104}. Best is trial 11 with value: 0.02431325.
[I 2025-08-04 18:06:01,438] Trial 13 finished with value: 0.024646500000000002 and parameters: {'beta': 0.025122279640374723, 'rand_seed': 939981}. Best is trial 11 with value: 0.02431325.
[I 2025-08-04 18:06:01,454] Trial 9 finished with value: 0.024202 and parameters: {'beta': 0.2826094882235986, 'rand_seed': 529560}. Best is trial 9 with value: 0.024202.
[I 2025-08-04 18:06:01,459] Trial 17 finished with value: 0.024646500000000002 and parameters: {'beta': 0.10525677575114477, 'rand_seed': 416325}. Best is trial 9 with value: 0.024202.
[I 2025-08-04 18:06:01,474] Trial 14 finished with value: 0.02431325 and parameters: {'beta': 0.19551294607769445, 'rand_seed': 501594}. Best is trial 9 with value: 0.024202.
[I 2025-08-04 18:06:01,491] Trial 7 finished with value: 0.02453425 and parameters: {'beta': 0.1558078609373016, 'rand_seed': 553213}. Best is trial 9 with value: 0.024202.
[I 2025-08-04 18:06:01,505] Trial 15 finished with value: 0.024646500000000002 and parameters: {'beta': 0.05295489053032275, 'rand_seed': 957211}. Best is trial 9 with value: 0.024202.
[I 2025-08-04 18:06:01,505] Trial 12 finished with value: 0.024646500000000002 and parameters: {'beta': 0.011810378879347867, 'rand_seed': 293875}. Best is trial 9 with value: 0.024202.
[I 2025-08-04 18:06:01,506] Trial 8 finished with value: 0.024646500000000002 and parameters: {'beta': 0.030139367611309073, 'rand_seed': 591577}. Best is trial 9 with value: 0.024202.
[I 2025-08-04 18:06:01,518] Trial 0 finished with value: 0.024646500000000002 and parameters: {'beta': 0.018485014725483816, 'rand_seed': 976184}. Best is trial 9 with value: 0.024202.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre>Making results structure...

Processed 20 trials; 0 failed

Best pars: {'beta': 0.2826094882235986, 'rand_seed': 529560}

Removed existing calibration file starsim_calibration.db

<span class="ansi-cyan-fg">

Checking fit...</span>

Fit with original pars: 0.024646500000000002

Fit with best-fit pars: 0.024021

✓ Calibration improved fit 0.024646500000000002 --&gt; 0.024021
</pre>
</div>
</div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>True</code></pre>
</div>
</div>
<p>For more, take a look at <code>test_calibration.py</code> in the <code>tests</code> directory.</p>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../user_guide/workflows_run.html" class="pagination-link" aria-label="Multiple runs">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Multiple runs</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../user_guide/workflows_deploy.html" class="pagination-link" aria-label="Deployment">
        <span class="nav-page-text">Deployment</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>The docs were built for Starsim v3.0.1 (2025-08-04).<br>© 2023–2025, Gates Foundation. All rights reserved. <a href="https://www.gatesfoundation.org/Privacy-and-Cookies-Notice">Privacy and Cookies Notice</a> | <a href="https://www.gatesfoundation.org/Terms-of-Use">Terms of Use</a></p>
<div class="toc-actions"><ul><li><a href="https://github.com/starsimhub/starsim/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/starsimhub/starsim">
      <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="mailto:info@starsim.org">
      <i class="bi bi-envelope-at-fill" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://starsim.org/">
      <i class="bi bi-globe" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>